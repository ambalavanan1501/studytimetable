import{j as e,X as t,g as s,p as a,A as l,s as r,D as n,F as i,t as o,T as c,u as d,i as m,k as u,l as x,v as p,G as h,w as f,x as b,y as j,c as g,z as y,E as v,J as w,K as N,N as _,I as S,O as C}from"./ui-vendor-yoAZ-FXJ.js";import{r as k,e as T}from"./react-vendor-DR97ylRc.js";import{u as D,s as A,d as F,b as O,a as P,e as q,c as E}from"./index-DAQF3p40.js";import{E as z,a as $,_ as R}from"./pdf-vendor-D0-bFhii.js";import{S as L}from"./SEO-Cj0rsF6y.js";import"./supabase-vendor-C9Ts7tiD.js";function I({isOpen:l,onClose:r,currentProfile:n,onSuccess:i}){const{user:o}=D(),[c,d]=k.useState(!1),[m,u]=k.useState({full_name:"",university:"",branch:"",semester:"",cgpa:"",credits:""});k.useEffect(()=>{var e,t;n&&u({full_name:n.full_name||"",university:n.university||"",branch:n.branch||"",semester:n.semester||"",cgpa:(null==(e=n.cgpa)?void 0:e.toString())||"",credits:(null==(t=n.credits)?void 0:t.toString())||""})},[n]);return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Edit Profile"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o){d(!0);try{const{error:e}=await A.from("profiles").upsert({id:o.id,full_name:m.full_name,university:m.university,branch:m.branch,semester:m.semester,cgpa:parseFloat(m.cgpa)||0,credits:parseFloat(m.credits)||0,updated_at:(new Date).toISOString()});if(e)throw e;i(),r()}catch(t){}finally{d(!1)}}},className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Full Name"}),e.jsx("input",{type:"text",value:m.full_name,onChange:e=>u({...m,full_name:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all",placeholder:"John Doe"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"University"}),e.jsx("input",{type:"text",value:m.university,onChange:e=>u({...m,university:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all",placeholder:"VIT"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Branch"}),e.jsx("input",{type:"text",value:m.branch,onChange:e=>u({...m,branch:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all",placeholder:"CSE"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Semester"}),e.jsx("input",{type:"text",value:m.semester,onChange:e=>u({...m,semester:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all",placeholder:"Fall 2024-25"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"CGPA"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"10",value:m.cgpa,onChange:e=>u({...m,cgpa:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all",placeholder:"9.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Credits"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:m.credits,onChange:e=>u({...m,credits:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all",placeholder:"24.5"})]})]}),e.jsxs("button",{type:"submit",disabled:c,className:"w-full py-3 px-4 bg-primary-600 text-white rounded-xl font-bold hover:bg-primary-700 active:scale-95 transition-all flex items-center justify-center gap-2 shadow-lg shadow-primary-500/30",children:[c?e.jsx(s,{className:"h-5 w-5 animate-spin"}):e.jsx(a,{className:"h-5 w-5"}),"Save Changes"]})]})]})}):null}function U({isOpen:a,onClose:c}){const{user:d}=D(),[m,u]=k.useState(!1),[x,p]=k.useState(null),h=k.useRef(null);if(!a)return null;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-white/50 animate-in fade-in zoom-in duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"App Settings"}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),x&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl flex items-center gap-2 text-sm font-medium "+("success"===x.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[e.jsx(l,{className:"h-4 w-4"}),x.text]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider",children:"Export Data"}),e.jsxs("button",{onClick:async()=>{if(d){u(!0),p(null);try{const[e,t]=await Promise.all([A.from("timetable_entries").select("*").eq("user_id",d.id),A.from("smart_timetable_entries").select("*").eq("user_id",d.id)]),s={timestamp:(new Date).toISOString(),timetable_entries:e.data||[],smart_timetable_entries:t.data||[]},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download=`timetable_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l),p({type:"success",text:"Backup downloaded successfully!"})}catch(e){p({type:"error",text:"Failed to export data."})}finally{u(!1)}}},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:scale-110 transition-transform",children:e.jsx(r,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Backup as JSON"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Save all your data to a file"})]})]}),e.jsx(n,{className:"h-5 w-5 text-slate-400"})]}),e.jsxs("button",{onClick:async()=>{if(d){u(!0),p(null);try{const{data:e}=await A.from("timetable_entries").select("*").eq("user_id",d.id),{data:t}=await A.from("smart_timetable_entries").select("*").eq("user_id",d.id),s=[...e||[],...t||[]],a={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:7};s.sort((e,t)=>{const s=(a[e.day]||0)-(a[t.day]||0);return 0!==s?s:e.start_time.localeCompare(t.start_time)});const l=new z;l.setFontSize(20),l.text("My Timetable",14,22),l.setFontSize(10),l.text(`Generated on ${(new Date).toLocaleDateString()}`,14,30);const r=s.map(e=>[e.day,`${e.start_time.slice(0,5)} - ${e.end_time.slice(0,5)}`,e.subject_name,e.room_number||"-",e.type.toUpperCase()]);$(l,{head:[["Day","Time","Subject","Room","Type"]],body:r,startY:40,styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[147,51,234]},alternateRowStyles:{fillColor:[243,244,246]}}),l.save("timetable.pdf"),p({type:"success",text:"PDF downloaded successfully!"})}catch(e){p({type:"error",text:"Failed to generate PDF."})}finally{u(!1)}}},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 group-hover:scale-110 transition-transform",children:e.jsx(i,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Export as PDF"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Download printable timetable"})]})]}),e.jsx(n,{className:"h-5 w-5 text-slate-400"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider",children:"Import Data"}),e.jsxs("button",{onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group border-2 border-dashed border-slate-300 hover:border-purple-400",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:scale-110 transition-transform",children:e.jsx(o,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Restore from Backup"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload a JSON file to restore"})]})]}),m&&e.jsx(s,{className:"h-5 w-5 animate-spin text-purple-600"})]}),e.jsx("input",{type:"file",ref:h,onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s||!d)return;u(!0),p(null);const a=new FileReader;a.onload=async e=>{var t;try{const s=JSON.parse(null==(t=e.target)?void 0:t.result);if(!s.timetable_entries&&!s.smart_timetable_entries)throw new Error("Invalid backup file format");const a=(s.timetable_entries||[]).map(({id:e,created_at:t,...s})=>({...s,user_id:d.id})),l=(s.smart_timetable_entries||[]).map(({id:e,created_at:t,...s})=>({...s,user_id:d.id}));if(a.length>0){const{error:e}=await A.from("timetable_entries").insert(a);if(e)throw e}if(l.length>0){const{error:e}=await A.from("smart_timetable_entries").insert(l);if(e)throw e}p({type:"success",text:"Data imported successfully! Refreshing..."}),setTimeout(()=>window.location.reload(),1500)}catch(s){p({type:"error",text:"Failed to import data. Invalid file."})}finally{u(!1),h.current&&(h.current.value="")}},a.readAsText(s)},accept:".json",className:"hidden"})]})]})]})})})}function B({isOpen:l,onClose:r,classData:n,onSuccess:i}){const[o,d]=k.useState(!1),[m,u]=k.useState({subject_name:"",subject_code:"",room_number:"",start_time:"",end_time:""});if(k.useEffect(()=>{n&&u({subject_name:n.subject_name||"",subject_code:n.subject_code||"",room_number:n.room_number||"",start_time:n.start_time||"",end_time:n.end_time||""})},[n]),!l||!n)return null;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-white/50 animate-in fade-in zoom-in duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Edit Class"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d(!0);try{const e={subject_name:m.subject_name,subject_code:m.subject_code,room_number:m.room_number,start_time:m.start_time,end_time:m.end_time},{error:t}=await A.from("timetable_entries").update(e).eq("id",n.id),{error:s}=await A.from("smart_timetable_entries").update(e).eq("id",n.id);if(t&&s)throw new Error("Failed to update class");i(),r()}catch(t){}finally{d(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Subject Name"}),e.jsx("input",{type:"text",value:m.subject_name,onChange:e=>u({...m,subject_name:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Subject Code"}),e.jsx("input",{type:"text",value:m.subject_code,onChange:e=>u({...m,subject_code:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Room"}),e.jsx("input",{type:"text",value:m.room_number,onChange:e=>u({...m,room_number:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:m.start_time,onChange:e=>u({...m,start_time:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:m.end_time,onChange:e=>u({...m,end_time:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-bold shadow-lg shadow-primary-200 transition-all flex items-center justify-center gap-2 mt-4",children:[o?e.jsx(s,{className:"h-5 w-5 animate-spin"}):e.jsx(a,{className:"h-5 w-5"}),"Save Changes"]}),e.jsxs("button",{type:"button",onClick:async()=>{if(confirm("Are you sure you want to delete this class?")){d(!0);try{await A.from("timetable_entries").delete().eq("id",n.id),await A.from("smart_timetable_entries").delete().eq("id",n.id),i(),r()}catch(e){}finally{d(!1)}}},disabled:o,className:"w-full py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:[e.jsx(c,{className:"h-5 w-5"}),"Delete Class"]})]})]})})})}function M({isOpen:a,onClose:l}){const{user:r}=D(),[n,i]=k.useState(!0),[o,c]=k.useState([]),[h,f]=k.useState(""),[b,j]=k.useState(null),[g,y]=k.useState(!1),v=async()=>{if(r){i(!0);try{const{data:e}=await A.from("timetable_entries").select("*").eq("user_id",r.id),{data:t}=await A.from("smart_timetable_entries").select("*").eq("user_id",r.id),s=[...e||[],...t||[]],a={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:7};s.sort((e,t)=>{const s=(a[e.day]||8)-(a[t.day]||8);return 0!==s?s:e.start_time.localeCompare(t.start_time)}),c(s)}catch(e){}finally{i(!1)}}};k.useEffect(()=>{a&&v()},[a,r]);const w=o.filter(e=>e.subject_name.toLowerCase().includes(h.toLowerCase())||e.subject_code.toLowerCase().includes(h.toLowerCase()));return a?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[80vh] animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Manage Timetable"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Edit or remove your scheduled classes"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsx("div",{className:"p-4 bg-slate-50 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search subjects...",value:h,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-xl border-none focus:ring-2 focus:ring-primary-500 bg-white shadow-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:n?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(s,{className:"h-8 w-8 animate-spin text-primary-500"})}):0===w.length?e.jsx("div",{className:"text-center py-10 text-slate-400",children:e.jsx("p",{children:"No classes found."})}):w.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between group hover:border-primary-200 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h3",{className:"font-bold text-slate-800 truncate",children:t.subject_name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 mt-1",children:[e.jsx("span",{className:"bg-slate-100 px-2 py-0.5 rounded text-slate-600 font-medium",children:t.subject_code}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"h-3 w-3"}),e.jsx("span",{children:t.day})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.start_time," - ",t.end_time]})]}),t.room_number&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3"}),e.jsx("span",{children:t.room_number})]})]})]}),e.jsx("button",{onClick:()=>(e=>{j(e),y(!0)})(t),className:"p-2 text-slate-300 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all",children:e.jsx(p,{className:"h-5 w-5"})})]},t.id))})]}),e.jsx(B,{isOpen:g,onClose:()=>y(!1),classData:b,onSuccess:()=>{v()}})]}):null}async function G(e){try{const{jsPDF:t,autoTable:s}=await async function(){const[{default:e},{default:t}]=await Promise.all([R(()=>import("./pdf-vendor-D0-bFhii.js").then(e=>e.j),[]),R(()=>import("./pdf-vendor-D0-bFhii.js").then(e=>e.c),[])]);return{jsPDF:e,autoTable:t}}(),a=new t,l=20;let r=20;const{data:n}=await A.from("profiles").select("*").eq("id",e).single(),{data:i}=await A.from("attendance_logs").select("*").eq("user_id",e);a.setFontSize(24),a.setTextColor(80,70,229),a.text("Student Academic Report",l,r),r+=10,a.setFontSize(10),a.setTextColor(100),a.text(`Generated on: ${(new Date).toLocaleDateString()}`,l,r),r+=15,a.setDrawColor(200),a.line(l,r,190,r),r+=10,a.setFontSize(14),a.setTextColor(0),a.text("Student Profile",l,r),r+=8,a.setFontSize(11),a.setTextColor(60);const o=(null==n?void 0:n.full_name)||"N/A",c=(null==n?void 0:n.university)||"N/A",d=`${(null==n?void 0:n.branch)||"-"} (${(null==n?void 0:n.semester)||"-"})`,m=(null==n?void 0:n.cgpa)?`${n.cgpa}`:"N/A";a.text(`Name: ${o}`,l,r),a.text(`University: ${c}`,110,r),r+=7,a.text(`Branch: ${d}`,l,r),a.text(`CGPA: ${m}`,110,r),r+=15;const u=new Map;null==i||i.forEach(e=>{const t=u.get(e.subject_name)||{total:0,attended:0};t.total+=1,"present"===e.status&&(t.attended+=1),u.set(e.subject_name,t)}),a.setFontSize(14),a.setTextColor(0),a.text("Attendance Summary",l,r),r+=5;const x=Array.from(u.entries()).map(([e,t])=>{const s=t.total-t.attended,a=t.total>0?(t.attended/t.total*100).toFixed(1)+"%":"0%";return[e,t.attended,s,t.total,a]});x.length>0?(s(a,{startY:r,head:[["Subject","Attended","Absent","Total Classes","Percentage"]],body:x,theme:"grid",headStyles:{fillColor:[80,70,229]},styles:{fontSize:10},margin:{top:20}}),r=a.lastAutoTable.finalY+20):(r+=10,a.setFontSize(10),a.setTextColor(150),a.text("No attendance records found.",l,r),r+=20,r+=20);const p=await F.getAllNotes();return p&&p.length>0&&(r>250&&(a.addPage(),r=20),a.setFontSize(14),a.setTextColor(0),a.text("Academic Vault (Notes)",l,r),r+=10,p.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),p.forEach(e=>{r>270&&(a.addPage(),r=20),a.setFontSize(12),a.setTextColor(0);const t=e.title||"Untitled Note";a.text(`• ${t}`,l,r),r+=7,a.setFontSize(10),a.setTextColor(80);const s=new Date(e.updatedAt).toLocaleDateString();a.text(`${s}`,l+5,r),r+=5,a.setFontSize(10),a.setTextColor(100);const n=a.splitTextToSize(e.content||"No content",170);a.text(n,l+5,r),r+=5*n.length+10})),a.setFontSize(8),a.setTextColor(150),a.text("Generated by CGPA Calculator",l,280),a.save(`report_${(new Date).toISOString().split("T")[0]}.pdf`),!0}catch(t){throw t}}const J=[{name:"Purple",value:"purple",class:"bg-purple-500"},{name:"Blue",value:"blue",class:"bg-blue-500"},{name:"Green",value:"green",class:"bg-emerald-500"},{name:"Orange",value:"orange",class:"bg-orange-500"},{name:"Pink",value:"pink",class:"bg-pink-500"}];function V(){var t;const{user:a}=D(),{mode:l,setTheme:r,setMode:o}=O(),{addToast:d}=P(),{level:u,xp:x}=q(),p=T(),[z,$]=k.useState(null),[R,B]=k.useState(!0),[V,Y]=k.useState(!1),[W,K]=k.useState(!1),[X,H]=k.useState(!1),[Q,Z]=k.useState(null),[ee,te]=k.useState(!1),[se,ae]=k.useState(!1),[le,re]=k.useState(!1),ne=async()=>{try{te(!0);const e=await async function(){try{const t=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer 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","Content-Type":"application/json"},body:JSON.stringify({model:"x-ai/grok-4.1-fast:free",messages:[{role:"user",content:"Give me a short, inspiring quote for a university student. Format it as JSON with 'quote' and 'author' fields. Do not include any markdown formatting."}],reasoning:{enabled:!0}})});if(!t.ok)throw new Error(`API call failed: ${t.statusText}`);const s=(await t.json()).choices[0].message.content;try{const e=s.replace(/```json\n?|\n?```/g,"").trim();return JSON.parse(e)}catch(e){return{quote:s,author:"AI Assistant"}}}catch(t){throw t}}();Z(e)}catch(e){}finally{te(!1)}};k.useEffect(()=>{ne()},[]);const ie=async()=>{if(a)try{const{data:e,error:t}=await A.from("profiles").select("*").eq("id",a.id).single();t&&t.code;const s=e||{full_name:"",university:"",branch:"",semester:"",theme_preference:"light",attendance_goal:75,accent_color:"purple",cgpa:0,credits:0,avatar_url:null};$(s),s.accent_color&&r(s.accent_color)}catch(e){}finally{B(!1)}};k.useEffect(()=>{ie()},[a]);return R?e.jsx("div",{className:"flex h-full items-center justify-center pt-20",children:e.jsx(s,{className:"h-8 w-8 animate-spin text-primary-600"})}):e.jsxs("div",{className:"p-6 space-y-8 pb-32",children:[e.jsx(L,{title:"Profile",description:"Manage your profile settings and goals."}),e.jsx("h1",{className:"text-2xl font-bold text-slate-800 mt-4",children:"Profile"}),e.jsxs("div",{className:"glass-card rounded-3xl p-6 flex items-center gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary-500 to-pink-500 rounded-full flex items-center justify-center text-white text-2xl font-bold shadow-lg overflow-hidden",children:(null==z?void 0:z.avatar_url)?e.jsx("img",{src:z.avatar_url,alt:"Avatar",className:"w-full h-full object-cover"}):(null==z?void 0:z.full_name)?z.full_name[0].toUpperCase():null==(t=null==a?void 0:a.email)?void 0:t[0].toUpperCase()}),e.jsxs("label",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:[e.jsx("span",{className:"text-white text-xs font-medium",children:se?"...":"Edit"}),e.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{try{if(ae(!0),!e.target.files||0===e.target.files.length)throw new Error("You must select an image to upload.");const t=e.target.files[0],s=t.name.split(".").pop(),l=`${`${Math.random()}.${s}`}`,{error:r}=await A.storage.from("avatars").upload(l,t);if(r)throw r;const{data:n}=A.storage.from("avatars").getPublicUrl(l),i=n.publicUrl;if(a&&z){const{error:e}=await A.from("profiles").update({avatar_url:i}).eq("id",a.id);if(e)throw e;$({...z,avatar_url:i}),d("Profile picture updated!","success")}}catch(t){d("Error uploading avatar!","error")}finally{ae(!1)}},disabled:se,className:"hidden"})]})]}),e.jsxs("div",{className:"overflow-hidden flex-1",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800 truncate",children:(null==z?void 0:z.full_name)||"Student"}),e.jsx("p",{className:"text-sm text-slate-500 truncate",children:null==a?void 0:a.email}),((null==z?void 0:z.university)||(null==z?void 0:z.branch))&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-slate-400",children:[e.jsx(h,{className:"h-3 w-3"}),e.jsxs("span",{className:"truncate",children:[z.university," ",z.branch&&`• ${z.branch}`," ",z.semester&&`• ${z.semester}`]})]}),((null==z?void 0:z.cgpa)||(null==z?void 0:z.credits))&&e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs font-medium",children:[z.cgpa>0&&e.jsxs("span",{className:"bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-md",children:["CGPA: ",z.cgpa]}),z.credits>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded-md",children:["Credits: ",z.credits]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 p-1.5 bg-yellow-50/80 rounded-lg w-fit",children:[e.jsx(f,{className:"h-3 w-3 text-yellow-600"}),e.jsxs("span",{className:"text-xs font-bold text-yellow-700",children:["Lvl ",u," Scholar"]}),e.jsx("div",{className:"h-2 w-px bg-yellow-200 mx-1"}),e.jsxs("span",{className:"text-xs text-yellow-600",children:[x," XP"]})]})]}),e.jsx("button",{onClick:()=>Y(!0),className:"p-2 bg-white/50 rounded-full hover:bg-white transition-colors",children:e.jsx(b,{className:"h-5 w-5 text-slate-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between ml-2",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider",children:"Daily Inspiration"}),e.jsx("button",{onClick:ne,disabled:ee,className:"p-1.5 rounded-full hover:bg-slate-100 text-slate-400 hover:text-primary-600 transition-colors disabled:opacity-50",children:e.jsx(j,{className:E("h-4 w-4",ee&&"animate-spin")})})]}),e.jsxs("div",{className:"glass-card rounded-3xl p-6 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(g,{className:"h-24 w-24 text-primary-500"})}),ee&&!Q?e.jsxs("div",{className:"flex flex-col gap-2 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-slate-200 rounded w-1/4 mt-2 ml-auto"})]}):e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"text-lg font-medium text-slate-700 italic leading-relaxed",children:['"',(null==Q?void 0:Q.quote)||"Believe you can and you're halfway there.",'"']}),e.jsxs("p",{className:"text-sm text-primary-600 font-semibold mt-3 text-right",children:["— ",(null==Q?void 0:Q.author)||"Theodore Roosevelt"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider ml-2",children:"Appearance"}),e.jsxs("div",{className:"glass-card rounded-3xl p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center text-primary-600",children:e.jsx(y,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700",children:"Accent Color"})]}),e.jsx("div",{className:"flex justify-between gap-2",children:J.map(t=>e.jsx("button",{onClick:()=>(async e=>{a&&z&&(r(e),$({...z,accent_color:e}),await A.from("profiles").update({accent_color:e}).eq("id",a.id))})(t.value),className:E("w-10 h-10 rounded-full transition-all flex items-center justify-center",t.class,(null==z?void 0:z.accent_color)===t.value?"ring-4 ring-white shadow-lg scale-110":"opacity-70 hover:opacity-100"),title:t.name},t.value))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider ml-2",children:"Display Mode"}),e.jsxs("div",{className:"glass-card rounded-3xl p-5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:E("w-8 h-8 rounded-full flex items-center justify-center transition-colors","dark"===l?"bg-slate-700 text-slate-300":"bg-orange-100 text-orange-500"),children:"dark"===l?e.jsx(v,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:"Dark Mode"})]}),e.jsx("button",{onClick:()=>o("light"===l?"dark":"light"),className:E("w-14 h-8 rounded-full transition-colors relative","dark"===l?"bg-primary-600":"bg-slate-200"),children:e.jsx("div",{className:E("absolute top-1 left-1 bg-white w-6 h-6 rounded-full shadow-sm transition-transform duration-300","dark"===l?"translate-x-6":"translate-x-0")})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider ml-2",children:"Goals"}),e.jsxs("div",{className:"glass-card rounded-3xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600",children:e.jsx(N,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700",children:"Attendance Goal"})]}),e.jsxs("span",{className:"font-bold text-primary-600",children:[null==z?void 0:z.attendance_goal,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:(null==z?void 0:z.attendance_goal)||75,onChange:async e=>{if(!a||!z)return;const t=parseInt(e.target.value);$({...z,attendance_goal:t}),await A.from("profiles").update({attendance_goal:t}).eq("id",a.id)},className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary-600"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mt-2",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider ml-2",children:"Preferences"}),e.jsx("div",{className:"glass-card rounded-3xl overflow-hidden",children:e.jsx("div",{className:"divide-y divide-slate-100",children:e.jsxs("button",{onClick:()=>K(!0),className:"w-full p-4 flex items-center justify-between hover:bg-white/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600",children:e.jsx(b,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700",children:"App Settings"})]}),e.jsx(_,{className:"h-4 w-4 text-slate-400"})]})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider ml-2",children:"Data Management"}),e.jsxs("div",{className:"glass-card rounded-3xl overflow-hidden p-2 space-y-2",children:[e.jsx("button",{onClick:async()=>{if(a)try{re(!0),await G(a.id),d("PDF report generated.","success")}catch(e){d("Failed to generate PDF report.","error")}finally{re(!1)}},disabled:le,className:"w-full p-4 flex items-center justify-between hover:bg-white/40 rounded-2xl transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-200 transition-colors",children:le?e.jsx(s,{className:"h-4 w-4 animate-spin"}):e.jsx(i,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700",children:"Export Report (PDF)"})]})}),e.jsx("button",{onClick:()=>H(!0),className:"w-full p-4 flex items-center justify-between hover:bg-white/40 rounded-2xl transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:bg-purple-200 transition-colors",children:e.jsx(m,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700",children:"Manage Timetable"})]})}),e.jsx("button",{onClick:async()=>{if(a)try{re(!0),await async function(e){try{const{data:t}=await A.from("profiles").select("*").eq("id",e).single(),{data:s}=await A.from("timetable_entries").select("*").eq("user_id",e),{data:a}=await A.from("smart_timetable_entries").select("*").eq("user_id",e),{data:l}=await A.from("attendance_logs").select("*").eq("user_id",e),r=await F.getAllSimulatorSubjects(),n=await F.getAllNotes(),i=await F.getAllCountdowns(),o=await F.getAllTasks(),c={version:1,timestamp:(new Date).toISOString(),user:{id:e,profile:t||{}},academics:{timetable:s||[],smart_timetable:a||[],attendance_logs:l||[]},local_data:{simulator_subjects:r||[],notes:n||[],countdowns:i||[],tasks:o||[]}},d=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),m=URL.createObjectURL(d),u=document.createElement("a");return u.href=m,u.download=`academic_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(m),!0}catch(t){throw t}}(a.id),d("Backup downloaded successfully.","success")}catch(e){d("Failed to backup data.","error")}finally{re(!1)}},disabled:le,className:"w-full p-4 flex items-center justify-between hover:bg-white/40 rounded-2xl transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 group-hover:bg-emerald-200 transition-colors",children:le?e.jsx(s,{className:"h-4 w-4 animate-spin"}):e.jsx(n,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700",children:"Backup Data (JSON)"})]})}),e.jsx("div",{className:"h-px bg-slate-100 mx-4"}),e.jsx("button",{onClick:async()=>{if(a&&confirm("Are you sure you want to delete all timetable and attendance data? This action cannot be undone."))try{B(!0),await A.from("timetable_entries").delete().eq("user_id",a.id),await A.from("smart_timetable_entries").delete().eq("user_id",a.id),await A.from("attendance_logs").delete().eq("user_id",a.id),d("All data has been reset successfully.","success")}catch(e){d("Failed to reset data.","error")}finally{B(!1)}},className:"w-full p-4 flex items-center justify-between hover:bg-red-50 rounded-2xl transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 group-hover:bg-red-200 transition-colors",children:e.jsx(c,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-slate-700 group-hover:text-red-700 transition-colors",children:"Reset All Data"})]})})]})]}),e.jsx("div",{className:"text-center py-6",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/30 text-slate-500 text-xs font-medium",children:[e.jsx(S,{className:"h-3 w-3"}),e.jsx("span",{children:"Version 10.41.15.1 • Made By Ambalavanan "})]})}),e.jsxs("button",{onClick:async()=>{await A.auth.signOut(),p("/login")},className:"w-full glass-card rounded-2xl p-4 flex items-center justify-center gap-2 text-red-500 font-bold hover:bg-red-50 transition-colors",children:[e.jsx(C,{className:"h-5 w-5"}),"Sign Out"]}),e.jsx(I,{isOpen:V,onClose:()=>Y(!1),currentProfile:z,onSuccess:ie}),e.jsx(U,{isOpen:W,onClose:()=>K(!1)}),e.jsx(M,{isOpen:X,onClose:()=>H(!1)})]})}export{V as Profile};
