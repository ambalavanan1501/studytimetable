import{j as e,X as t,U as s,L as a,a as l,S as r,A as n,s as i,D as o,F as c,t as d,T as m,u,c as x,d as p,M as h,v as f,w as b,G as g,x as j,p as v,y as w,z as y,l as N,E as _,H as S}from"./ui-vendor-cRf8bXM2.js";import{r as C,f as k}from"./react-vendor-UBAF-OWM.js";import{u as T,b as D,c as F,s as A,d as P,a as O}from"./index-BHdFRAsM.js";import{E as z,a as q,_ as E}from"./pdf-vendor-0-8C3xHX.js";import{f as R}from"./ai-DP1zq5fw.js";import{S as L}from"./SEO-CM7liykF.js";import{d as $}from"./db-CqolmD4V.js";import"./supabase-vendor-B9h0k0q2.js";function U({isOpen:n,onClose:i,currentProfile:o,onSuccess:c}){const{user:d}=T(),{level:m}=D(),[u,x]=C.useState(!1),[p,h]=C.useState({full_name:"",university:"",branch:"",semester:"",cgpa:"",credits:"",avatar_url:""});C.useEffect(()=>{var e,t;o&&h({full_name:o.full_name||"",university:o.university||"",branch:o.branch||"",semester:o.semester||"",cgpa:(null==(e=o.cgpa)?void 0:e.toString())||"",credits:(null==(t=o.credits)?void 0:t.toString())||"",avatar_url:o.avatar_url||""})},[o]);return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Edit Profile"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d){x(!0);try{const{error:e}=await A.from("profiles").upsert({id:d.id,full_name:p.full_name,university:p.university,branch:p.branch,semester:p.semester,cgpa:parseFloat(p.cgpa)||0,credits:parseFloat(p.credits)||0,updated_at:(new Date).toISOString()});if(e)throw e;c(),i()}catch(t){}finally{x(!1)}}},className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[e.jsx("div",{className:F("w-24 h-24 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden border-4 shadow-lg transition-all duration-300",m>=5?"border-indigo-400 shadow-indigo-200":"border-white"),children:p.avatar_url?e.jsx("img",{src:p.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(s,{className:"h-10 w-10 text-slate-400"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-slate-100 px-3 py-1 rounded-full text-xs font-bold text-slate-600 border border-slate-200",children:["Lvl ",m]}),m<5&&e.jsxs("div",{className:"text-[10px] text-slate-400 font-bold flex items-center gap-1",children:[e.jsx(a,{className:"h-3 w-3"}),e.jsx("span",{children:"Lvl 5 unlocks border"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Full Name"}),e.jsx("input",{type:"text",value:p.full_name,onChange:e=>h({...p,full_name:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"John Doe"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"University"}),e.jsx("input",{type:"text",value:p.university,onChange:e=>h({...p,university:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"University Name"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Branch/Major"}),e.jsx("input",{type:"text",value:p.branch,onChange:e=>h({...p,branch:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"Computer Science"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Semester"}),e.jsx("input",{type:"text",value:p.semester,onChange:e=>h({...p,semester:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"Fall 2024"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"CGPA"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"10",value:p.cgpa,onChange:e=>h({...p,cgpa:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"9.5"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Credits"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:p.credits,onChange:e=>h({...p,credits:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"24.5"})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:i,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:u,className:"bg-slate-900 text-white px-8 py-2.5 rounded-xl font-bold hover:scale-105 active:scale-95 transition-all shadow-lg flex items-center gap-2",children:[u?e.jsx(l,{className:"h-4 w-4 animate-spin"}):e.jsx(r,{className:"h-4 w-4"}),"Save Changes"]})]})]})]})}):null}function I({isOpen:s,onClose:a}){const{user:r}=T(),[m,u]=C.useState(!1),[x,p]=C.useState(null),h=C.useRef(null);if(!s)return null;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-white/50 animate-in fade-in zoom-in duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"App Settings"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),x&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl flex items-center gap-2 text-sm font-medium "+("success"===x.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[e.jsx(n,{className:"h-4 w-4"}),x.text]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider",children:"Export Data"}),e.jsxs("button",{onClick:async()=>{if(r){u(!0),p(null);try{const[e,t]=await Promise.all([A.from("timetable_entries").select("*").eq("user_id",r.id),A.from("smart_timetable_entries").select("*").eq("user_id",r.id)]),s={timestamp:(new Date).toISOString(),timetable_entries:e.data||[],smart_timetable_entries:t.data||[]},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=`timetable_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),p({type:"success",text:"Backup downloaded successfully!"})}catch(e){p({type:"error",text:"Failed to export data."})}finally{u(!1)}}},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:scale-110 transition-transform",children:e.jsx(i,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Backup as JSON"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Save all your data to a file"})]})]}),e.jsx(o,{className:"h-5 w-5 text-slate-400"})]}),e.jsxs("button",{onClick:async()=>{if(r){u(!0),p(null);try{const{data:e}=await A.from("timetable_entries").select("*").eq("user_id",r.id),{data:t}=await A.from("smart_timetable_entries").select("*").eq("user_id",r.id),s=[...e||[],...t||[]],a={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:7};s.sort((e,t)=>{const s=(a[e.day]||0)-(a[t.day]||0);return 0!==s?s:e.start_time.localeCompare(t.start_time)});const l=new z;l.setFontSize(20),l.text("My Timetable",14,22),l.setFontSize(10),l.text(`Generated on ${(new Date).toLocaleDateString()}`,14,30);const n=s.map(e=>[e.day,`${e.start_time.slice(0,5)} - ${e.end_time.slice(0,5)}`,e.subject_name,e.room_number||"-",e.type.toUpperCase()]);q(l,{head:[["Day","Time","Subject","Room","Type"]],body:n,startY:40,styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[147,51,234]},alternateRowStyles:{fillColor:[243,244,246]}}),l.save("timetable.pdf"),p({type:"success",text:"PDF downloaded successfully!"})}catch(e){p({type:"error",text:"Failed to generate PDF."})}finally{u(!1)}}},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 group-hover:scale-110 transition-transform",children:e.jsx(c,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Export as PDF"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Download printable timetable"})]})]}),e.jsx(o,{className:"h-5 w-5 text-slate-400"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider",children:"Import Data"}),e.jsxs("button",{onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group border-2 border-dashed border-slate-300 hover:border-purple-400",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:scale-110 transition-transform",children:e.jsx(d,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Restore from Backup"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload a JSON file to restore"})]})]}),m&&e.jsx(l,{className:"h-5 w-5 animate-spin text-purple-600"})]}),e.jsx("input",{type:"file",ref:h,onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s||!r)return;u(!0),p(null);const a=new FileReader;a.onload=async e=>{var t;try{const s=JSON.parse(null==(t=e.target)?void 0:t.result);if(!s.timetable_entries&&!s.smart_timetable_entries)throw new Error("Invalid backup file format");const a=(s.timetable_entries||[]).map(({id:e,created_at:t,...s})=>({...s,user_id:r.id})),l=(s.smart_timetable_entries||[]).map(({id:e,created_at:t,...s})=>({...s,user_id:r.id}));if(a.length>0){const{error:e}=await A.from("timetable_entries").insert(a);if(e)throw e}if(l.length>0){const{error:e}=await A.from("smart_timetable_entries").insert(l);if(e)throw e}p({type:"success",text:"Data imported successfully! Refreshing..."}),setTimeout(()=>window.location.reload(),1500)}catch(s){p({type:"error",text:"Failed to import data. Invalid file."})}finally{u(!1),h.current&&(h.current.value="")}},a.readAsText(s)},accept:".json",className:"hidden"})]})]})]})})})}function B({isOpen:s,onClose:a,classData:n,onSuccess:i}){const[o,c]=C.useState(!1),[d,u]=C.useState({subject_name:"",subject_code:"",room_number:"",start_time:"",end_time:""});if(C.useEffect(()=>{n&&u({subject_name:n.subject_name||"",subject_code:n.subject_code||"",room_number:n.room_number||"",start_time:n.start_time||"",end_time:n.end_time||""})},[n]),!s||!n)return null;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-white/50 animate-in fade-in zoom-in duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Edit Class"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0);try{const e={subject_name:d.subject_name,subject_code:d.subject_code,room_number:d.room_number,start_time:d.start_time,end_time:d.end_time},{error:t}=await A.from("timetable_entries").update(e).eq("id",n.id),{error:s}=await A.from("smart_timetable_entries").update(e).eq("id",n.id);if(t&&s)throw new Error("Failed to update class");i(),a()}catch(t){}finally{c(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Subject Name"}),e.jsx("input",{type:"text",value:d.subject_name,onChange:e=>u({...d,subject_name:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Subject Code"}),e.jsx("input",{type:"text",value:d.subject_code,onChange:e=>u({...d,subject_code:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Room"}),e.jsx("input",{type:"text",value:d.room_number,onChange:e=>u({...d,room_number:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:d.start_time,onChange:e=>u({...d,start_time:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:d.end_time,onChange:e=>u({...d,end_time:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-bold shadow-lg shadow-primary-200 transition-all flex items-center justify-center gap-2 mt-4",children:[o?e.jsx(l,{className:"h-5 w-5 animate-spin"}):e.jsx(r,{className:"h-5 w-5"}),"Save Changes"]}),e.jsxs("button",{type:"button",onClick:async()=>{if(confirm("Are you sure you want to delete this class?")){c(!0);try{await A.from("timetable_entries").delete().eq("id",n.id),await A.from("smart_timetable_entries").delete().eq("id",n.id),i(),a()}catch(e){}finally{c(!1)}}},disabled:o,className:"w-full py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:[e.jsx(m,{className:"h-5 w-5"}),"Delete Class"]})]})]})})})}function G({isOpen:s,onClose:a}){const{user:r}=T(),[n,i]=C.useState(!0),[o,c]=C.useState([]),[d,m]=C.useState(""),[b,g]=C.useState(null),[j,v]=C.useState(!1),w=async()=>{if(r){i(!0);try{const{data:e}=await A.from("timetable_entries").select("*").eq("user_id",r.id),{data:t}=await A.from("smart_timetable_entries").select("*").eq("user_id",r.id),s=[...e||[],...t||[]],a={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:7};s.sort((e,t)=>{const s=(a[e.day]||8)-(a[t.day]||8);return 0!==s?s:e.start_time.localeCompare(t.start_time)}),c(s)}catch(e){}finally{i(!1)}}};C.useEffect(()=>{s&&w()},[s,r]);const y=o.filter(e=>e.subject_name.toLowerCase().includes(d.toLowerCase())||e.subject_code.toLowerCase().includes(d.toLowerCase()));return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[80vh] animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Manage Timetable"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Edit or remove your scheduled classes"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsx("div",{className:"p-4 bg-slate-50 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search subjects...",value:d,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-xl border-none focus:ring-2 focus:ring-primary-500 bg-white shadow-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:n?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(l,{className:"h-8 w-8 animate-spin text-primary-500"})}):0===y.length?e.jsx("div",{className:"text-center py-10 text-slate-400",children:e.jsx("p",{children:"No classes found."})}):y.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between group hover:border-primary-200 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h3",{className:"font-bold text-slate-800 truncate",children:t.subject_name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 mt-1",children:[e.jsx("span",{className:"bg-slate-100 px-2 py-0.5 rounded text-slate-600 font-medium",children:t.subject_code}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3"}),e.jsx("span",{children:t.day})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.start_time," - ",t.end_time]})]}),t.room_number&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"}),e.jsx("span",{children:t.room_number})]})]})]}),e.jsx("button",{onClick:()=>(e=>{g(e),v(!0)})(t),className:"p-2 text-slate-300 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all",children:e.jsx(f,{className:"h-5 w-5"})})]},t.id))})]}),e.jsx(B,{isOpen:j,onClose:()=>v(!1),classData:b,onSuccess:()=>{w()}})]}):null}async function M(e){try{const{jsPDF:t,autoTable:s}=await async function(){const[{default:e},{default:t}]=await Promise.all([E(()=>import("./pdf-vendor-0-8C3xHX.js").then(e=>e.j),[]),E(()=>import("./pdf-vendor-0-8C3xHX.js").then(e=>e.c),[])]);return{jsPDF:e,autoTable:t}}(),a=new t,l=20;let r=20;const{data:n}=await A.from("profiles").select("*").eq("id",e).single(),{data:i}=await A.from("attendance_logs").select("*").eq("user_id",e);a.setFontSize(24),a.setTextColor(80,70,229),a.text("Student Academic Report",l,r),r+=10,a.setFontSize(10),a.setTextColor(100),a.text(`Generated on: ${(new Date).toLocaleDateString()}`,l,r),r+=15,a.setDrawColor(200),a.line(l,r,190,r),r+=10,a.setFontSize(14),a.setTextColor(0),a.text("Student Profile",l,r),r+=8,a.setFontSize(11),a.setTextColor(60);const o=(null==n?void 0:n.full_name)||"N/A",c=(null==n?void 0:n.university)||"N/A",d=`${(null==n?void 0:n.branch)||"-"} (${(null==n?void 0:n.semester)||"-"})`,m=(null==n?void 0:n.cgpa)?`${n.cgpa}`:"N/A";a.text(`Name: ${o}`,l,r),a.text(`University: ${c}`,110,r),r+=7,a.text(`Branch: ${d}`,l,r),a.text(`CGPA: ${m}`,110,r),r+=15;const u=new Map;null==i||i.forEach(e=>{const t=u.get(e.subject_name)||{total:0,attended:0};t.total+=1,"present"===e.status&&(t.attended+=1),u.set(e.subject_name,t)}),a.setFontSize(14),a.setTextColor(0),a.text("Attendance Summary",l,r),r+=5;const x=Array.from(u.entries()).map(([e,t])=>{const s=t.total-t.attended,a=t.total>0?(t.attended/t.total*100).toFixed(1)+"%":"0%";return[e,t.attended,s,t.total,a]});x.length>0?(s(a,{startY:r,head:[["Subject","Attended","Absent","Total Classes","Percentage"]],body:x,theme:"grid",headStyles:{fillColor:[80,70,229]},styles:{fontSize:10},margin:{top:20}}),r=a.lastAutoTable.finalY+20):(r+=10,a.setFontSize(10),a.setTextColor(150),a.text("No attendance records found.",l,r),r+=20,r+=20);const p=await $.getAllNotes();return p&&p.length>0&&(r>250&&(a.addPage(),r=20),a.setFontSize(14),a.setTextColor(0),a.text("Academic Vault (Notes)",l,r),r+=10,p.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),p.forEach(e=>{r>270&&(a.addPage(),r=20),a.setFontSize(12),a.setTextColor(0);const t=e.title||"Untitled Note";a.text(`• ${t}`,l,r),r+=7,a.setFontSize(10),a.setTextColor(80);const s=new Date(e.updatedAt).toLocaleDateString();a.text(`${s}`,l+5,r),r+=5,a.setFontSize(10),a.setTextColor(100);const n=a.splitTextToSize(e.content||"No content",170);a.text(n,l+5,r),r+=5*n.length+10})),a.setFontSize(8),a.setTextColor(150),a.text("Generated by CGPA Calculator",l,280),a.save(`report_${(new Date).toISOString().split("T")[0]}.pdf`),!0}catch(t){throw t}}const J=[{name:"Purple",value:"purple",class:"bg-purple-500"},{name:"Blue",value:"blue",class:"bg-blue-500"},{name:"Green",value:"green",class:"bg-emerald-500"},{name:"Orange",value:"orange",class:"bg-orange-500"},{name:"Pink",value:"pink",class:"bg-pink-500"}];function Y(){var t;const{user:s}=T(),{setTheme:a}=P(),{addToast:r}=O(),{level:n,xp:i}=D(),d=k(),[u,p]=C.useState(null),[h,f]=C.useState(!0),[z,q]=C.useState(!1),[E,B]=C.useState(!1),[Y,V]=C.useState(!1),[W,H]=C.useState(null),[Q,X]=C.useState(!1),[K,Z]=C.useState(!1),[ee,te]=C.useState(!1),se=async()=>{try{X(!0);const e=await R();H(e)}catch(e){}finally{X(!1)}};C.useEffect(()=>{se()},[]);const ae=async()=>{if(s)try{const{data:e,error:t}=await A.from("profiles").select("*").eq("id",s.id).single();t&&t.code;const l=e||{full_name:"",university:"",branch:"",semester:"",theme_preference:"light",attendance_goal:75,accent_color:"purple",cgpa:0,credits:0,avatar_url:null};p(l),l.accent_color&&a(l.accent_color)}catch(e){}finally{f(!1)}};C.useEffect(()=>{ae()},[s]);return h?e.jsx("div",{className:"flex h-full items-center justify-center pt-20",children:e.jsx(l,{className:"h-8 w-8 animate-spin text-primary-600"})}):e.jsxs("div",{className:"pb-32 space-y-10 animate-fade-in-up md:px-4",children:[e.jsx(L,{title:"Profile",description:"Manage your profile settings and goals."}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4 ml-2",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-semibold text-slate-900 tracking-tighter leading-none",children:"Profile"}),e.jsx("p",{className:"text-lg text-slate-500 font-medium font-display tracking-wide",children:"Identity & Preferences."})]}),e.jsxs("div",{className:"glass-vision rounded-[2.5rem] p-8 flex flex-col items-center text-center relative overflow-hidden group shadow-2xl",children:[e.jsx("div",{className:"absolute top-8 right-8 z-20",children:e.jsx("button",{onClick:()=>q(!0),className:"glass-button p-3 rounded-full text-slate-500 hover:text-slate-900 shadow-lg",children:e.jsx(b,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"relative z-10 mb-6 group-hover:scale-105 transition-transform duration-700",children:[e.jsxs("div",{className:"w-28 h-28 rounded-full flex items-center justify-center text-white text-4xl font-bold shadow-2xl ring-8 ring-white/30 overflow-hidden relative animate-breathe cursor-pointer",children:[(null==u?void 0:u.avatar_url)?e.jsx("img",{src:u.avatar_url,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center",children:(null==u?void 0:u.full_name)?u.full_name[0].toUpperCase():null==(t=null==s?void 0:s.email)?void 0:t[0].toUpperCase()}),e.jsxs("label",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-all cursor-pointer backdrop-blur-[2px]",children:[e.jsx("span",{className:"text-white text-xs font-bold uppercase tracking-wider",children:K?"...":"Change"}),e.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{try{if(Z(!0),!e.target.files||0===e.target.files.length)throw new Error("You must select an image to upload.");const t=e.target.files[0],a=t.name.split(".").pop(),l=`${`${Math.random()}.${a}`}`,{error:n}=await A.storage.from("avatars").upload(l,t);if(n)throw n;const{data:i}=A.storage.from("avatars").getPublicUrl(l),o=i.publicUrl;if(s&&u){const{error:e}=await A.from("profiles").update({avatar_url:o}).eq("id",s.id);if(e)throw e;p({...u,avatar_url:o}),r("Profile picture updated!","success")}}catch(t){r("Error uploading avatar!","error")}finally{Z(!1)}},disabled:K,className:"hidden"})]})]}),((null==u?void 0:u.university)||(null==u?void 0:u.branch))&&e.jsxs("div",{className:"absolute -bottom-4 left-1/2 -translate-x-1/2 glass-panel px-4 py-1.5 rounded-full shadow-lg border border-white/60 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(g,{className:"h-4 w-4 text-indigo-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-800",children:u.branch||"Student"})]})]}),e.jsxs("div",{className:"relative z-10 mt-6 space-y-1",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:(null==u?void 0:u.full_name)||"Student"}),e.jsx("p",{className:"text-lg text-slate-500 font-medium",children:null==s?void 0:s.email})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-8",children:[e.jsxs("div",{className:"glass-panel px-5 py-2 rounded-2xl flex items-center gap-2 text-indigo-700 bg-indigo-50/50 border-indigo-100/50",children:[e.jsx(j,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("span",{className:"font-bold",children:["Lvl ",n]}),e.jsx("span",{className:"w-1 h-1 bg-indigo-300 rounded-full"}),e.jsxs("span",{className:"font-bold",children:[i," XP"]})]}),(null==u?void 0:u.cgpa)&&u.cgpa>0&&e.jsxs("div",{className:"glass-panel px-5 py-2 rounded-2xl text-emerald-700 font-bold bg-emerald-50/50 border-emerald-100/50",children:["CGPA ",u.cgpa]})]})]}),e.jsxs("div",{className:"glass-vision p-6 rounded-[2rem] relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity duration-500",children:e.jsx(v,{className:"h-40 w-40 text-slate-900 rotate-12"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2",children:"Daily Inspiration"}),e.jsx("button",{onClick:se,className:"glass-button p-2 rounded-full",children:e.jsx(w,{className:F("h-4 w-4",Q&&"animate-spin")})})]}),Q&&!W?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-6 bg-slate-200 rounded-full w-2/3"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded-full w-1/3"})]}):e.jsxs("div",{className:"md:pr-20",children:[e.jsxs("p",{className:"text-3xl md:text-4xl font-serif italic text-slate-800 leading-tight",children:['"',(null==W?void 0:W.quote)||"Believe you can and you're halfway there.",'"']}),e.jsxs("p",{className:"text-slate-500 font-bold mt-4 uppercase tracking-widest text-sm",children:["— ",(null==W?void 0:W.author)||"Theodore Roosevelt"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-vision p-6 rounded-[2rem]",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600 shadow-sm",children:e.jsx(y,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xl font-bold text-slate-900",children:"Theme"}),e.jsx("span",{className:"text-slate-500 text-sm",children:"Personalize accent"})]})]}),e.jsx("div",{className:"flex gap-3",children:J.map(t=>e.jsx("button",{onClick:()=>(async e=>{s&&u&&(a(e),p({...u,accent_color:e}),await A.from("profiles").update({accent_color:e}).eq("id",s.id))})(t.value),className:F("w-12 h-12 rounded-full transition-all duration-300 flex items-center justify-center shadow-sm hover:scale-110",t.class,(null==u?void 0:u.accent_color)===t.value?"ring-[6px] ring-white shadow-xl scale-110":"opacity-60")},t.value))})]}),e.jsxs("div",{className:"glass-vision p-6 rounded-[2rem]",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-emerald-50 flex items-center justify-center text-emerald-600 shadow-sm",children:e.jsx(N,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xl font-bold text-slate-900",children:"Goal"}),e.jsx("span",{className:"text-slate-500 text-sm",children:"Attendance Target"})]})]}),e.jsxs("span",{className:"text-3xl font-black text-emerald-500",children:[null==u?void 0:u.attendance_goal,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:(null==u?void 0:u.attendance_goal)||75,onChange:async e=>{if(!s||!u)return;const t=parseInt(e.target.value);p({...u,attendance_goal:t}),await A.from("profiles").update({attendance_goal:t}).eq("id",s.id)},className:"w-full h-3 bg-slate-100 rounded-full appearance-none cursor-pointer accent-emerald-500 hover:accent-emerald-400 transition-all"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest ml-4",children:"Quick Actions"}),e.jsx("div",{className:"glass-vision p-2 rounded-[2.5rem] grid gap-2",children:[{icon:x,label:"Manage Timetable",sub:"Add or edit classes",action:()=>V(!0),color:"purple"},{icon:c,label:"Export Report",sub:"Download PDF summary",action:async()=>{if(s)try{te(!0),await M(s.id),r("PDF report generated.","success")}catch(e){r("Failed to generate PDF report.","error")}finally{te(!1)}},color:"blue"},{icon:o,label:"Backup Data",sub:"Save as JSON",action:async()=>{if(s)try{te(!0),await async function(e){try{const{data:t}=await A.from("profiles").select("*").eq("id",e).single(),{data:s}=await A.from("timetable_entries").select("*").eq("user_id",e),{data:a}=await A.from("smart_timetable_entries").select("*").eq("user_id",e),{data:l}=await A.from("attendance_logs").select("*").eq("user_id",e),r=await $.getAllSimulatorSubjects(),n=await $.getAllNotes(),i=await $.getAllCountdowns(),o=await $.getAllTasks(),c={version:1,timestamp:(new Date).toISOString(),user:{id:e,profile:t||{}},academics:{timetable:s||[],smart_timetable:a||[],attendance_logs:l||[]},local_data:{simulator_subjects:r||[],notes:n||[],countdowns:i||[],tasks:o||[]}},d=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),m=URL.createObjectURL(d),u=document.createElement("a");return u.href=m,u.download=`academic_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(m),!0}catch(t){throw t}}(s.id),r("Backup downloaded successfully.","success")}catch(e){r("Failed to backup data.","error")}finally{te(!1)}},color:"sky"},{icon:m,label:"Reset All Data",sub:"Clear database",action:async()=>{if(s&&confirm("Are you sure you want to delete all timetable and attendance data? This action cannot be undone."))try{f(!0),await A.from("timetable_entries").delete().eq("user_id",s.id),await A.from("smart_timetable_entries").delete().eq("user_id",s.id),await A.from("attendance_logs").delete().eq("user_id",s.id),r("All data has been reset successfully.","success")}catch(e){r("Failed to reset data.","error")}finally{f(!1)}},color:"red"}].map((t,s)=>e.jsxs("button",{onClick:t.action,className:"w-full p-6 flex items-center justify-between hover:bg-white/50 rounded-[2rem] transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:F("w-14 h-14 rounded-2xl flex items-center justify-center text-white shadow-lg transition-transform group-hover:scale-110",`bg-${t.color}-500`),children:"Export Report"===t.label&&ee?e.jsx(l,{className:"h-6 w-6 animate-spin"}):e.jsx(t.icon,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"block text-lg font-bold text-slate-800",children:t.label}),e.jsx("span",{className:"text-slate-500 font-medium",children:t.sub})]})]}),e.jsx(_,{className:"h-6 w-6 text-slate-300 group-hover:text-slate-900 transition-colors"})]},s))})]}),e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-slate-300",children:"TT Tracker v10.5 NikiOS"})}),e.jsxs("button",{onClick:async()=>{await A.auth.signOut(),d("/login")},className:"w-full glass-button p-5 rounded-[2rem] flex items-center justify-center gap-3 text-red-500 font-bold hover:bg-red-50/50",children:[e.jsx(S,{className:"h-5 w-5"}),"Sign Out"]}),e.jsx(U,{isOpen:z,onClose:()=>q(!1),currentProfile:u,onSuccess:ae}),e.jsx(I,{isOpen:E,onClose:()=>B(!1)}),e.jsx(G,{isOpen:Y,onClose:()=>V(!1)})]})}export{Y as Profile};
