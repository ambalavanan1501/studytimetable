import{j as e,P as t,N as s,k as a,C as o,d,T as n}from"./ui-vendor-DKQiA0eN.js";import{r}from"./react-vendor-UBAF-OWM.js";import{d as i}from"./db-D0LAGLHJ.js";import{b as l,a as c,c as m}from"./index-Wa4DkabO.js";import{S as u}from"./SEO-CAYOhRuf.js";import{u as x,a as p,D as g,c as f,b as h,T as b,P as j,d as v,S as w,v as y,C as D}from"./dnd-vendor-DDEo0FFm.js";import"./pdf-vendor-0-8C3xHX.js";import"./supabase-vendor-B9h0k0q2.js";const N=[{id:"todo",title:"To Do",color:"bg-slate-50 border-slate-200",icon:s},{id:"in-progress",title:"In Progress",color:"bg-blue-50/50 border-blue-100",icon:a},{id:"done",title:"Completed",color:"bg-emerald-50/50 border-emerald-100",icon:o}];function k(){const{addXP:s}=l(),{addToast:a}=c(),[o,d]=r.useState([]),[n,m]=r.useState(null),[v,w]=r.useState(""),[y,D]=r.useState(""),k=x(p(j,{activationConstraint:{distance:5}}),p(b));r.useEffect(()=>{T()},[]);const T=async()=>{try{const e=(await i.getAllTasks()).map(e=>({...e,status:e.status?e.status:e.completed?"done":"todo",createdAt:new Date(e.createdAt),dueDate:e.dueDate?new Date(e.dueDate):void 0}));d(e.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()))}catch(e){}},A=async e=>{confirm("Delete this task?")&&(await i.deleteTask(e),d(o.filter(t=>t.id!==e)))},U=async(e,t)=>{const n=o.find(t=>t.id===e);if(!n||n.status===t)return;const r={...n,status:t};d(o.map(t=>t.id===e?r:t)),await i.saveTask(r),"done"===t&&(s(50,"Task Completed"),a("Task completed! +50 XP","success"))};return e.jsxs("div",{className:"min-h-screen p-2 md:p-6 pb-24 space-y-6",children:[e.jsx(u,{title:"Kanban Board",description:"Manage your tasks efficiently."}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-semibold text-slate-900 tracking-tighter",children:"Assignments"}),e.jsx("p",{className:"text-slate-500 font-medium text-sm",children:"Organize your academic workload."})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!v.trim())return;const t={id:crypto.randomUUID(),text:v.trim(),status:"todo",dueDate:y?new Date(y):void 0,createdAt:new Date};await i.saveTask(t),d([t,...o]),w(""),D(""),s(10,"Task Created")},className:"flex flex-col md:flex-row gap-2 w-full md:w-auto",children:[e.jsx("input",{type:"text",value:v,onChange:e=>w(e.target.value),placeholder:"Add new assignment...",className:"bg-white px-5 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-slate-900 w-full md:w-80 shadow-sm"}),e.jsx("input",{type:"date",value:y,onChange:e=>D(e.target.value),className:"bg-white px-5 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-slate-900 md:w-40 shadow-sm text-sm"}),e.jsx("button",{type:"submit",disabled:!v.trim(),className:"bg-slate-900 text-white p-3 rounded-xl hover:bg-slate-800 transition-all disabled:opacity-50 shadow-md flex items-center justify-center h-[50px] w-[50px]",children:e.jsx(t,{className:"h-5 w-5"})})]})]}),e.jsxs(g,{sensors:k,collisionDetection:f,onDragStart:e=>{m(e.active.id)},onDragEnd:async e=>{const{active:t,over:n}=e;if(m(null),!n)return;const r=o.find(e=>e.id===t.id);if(!r)return;let l=null;if(N.some(e=>e.id===n.id))l=n.id;else{const e=o.find(e=>e.id===n.id);e&&(l=e.status)}if(l&&l!==r.status){const e={...r,status:l};d(o.map(s=>s.id===t.id?e:s)),await i.saveTask(e),"done"===l&&"done"!==r.status&&(s(50,"Task Completed"),a("Task moved to Completed! +50 XP","success"))}},children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 h-full items-start mt-4",children:N.map(t=>e.jsx(S,{column:t,tasks:o.filter(e=>e.status===t.id),onDelete:A,onUpdateStatus:U},t.id))}),e.jsx(h,{children:n?e.jsx(C,{task:o.find(e=>e.id===n),onDelete:()=>{},onUpdateStatus:()=>{},isOverlay:!0}):null})]})]})}function S({column:t,tasks:s,onDelete:a,onUpdateStatus:o}){const{setNodeRef:d}=v({id:t.id,data:{type:"Column",column:t}});return e.jsxs("div",{ref:d,className:m("rounded-2xl p-4 min-h-[500px] border",t.color),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-slate-600 font-bold uppercase text-[10px] tracking-widest",children:[e.jsx(t.icon,{className:"h-4 w-4"}),t.title,e.jsx("span",{className:"bg-white px-2 py-0.5 rounded-md text-[9px] ml-auto border border-slate-100 shadow-sm text-slate-400",children:s.length})]}),e.jsx(w,{items:s.map(e=>e.id),strategy:y,children:e.jsxs("div",{className:"space-y-3",children:[s.map(t=>e.jsx(T,{task:t,onDelete:a,onUpdateStatus:o},t.id)),0===s.length&&e.jsx("div",{className:"h-24 flex flex-col items-center justify-center text-slate-300 text-[10px] font-bold uppercase tracking-wider border-2 border-dashed border-slate-200/50 rounded-xl",children:e.jsx("span",{children:"Empty"})})]})})]})}function T({task:t,onDelete:s,onUpdateStatus:a}){const{attributes:o,listeners:d,setNodeRef:n,transform:r,transition:i,isDragging:l}=v({id:t.id,data:{type:"Task",task:t}}),c={transform:D.Transform.toString(r),transition:i};return e.jsx("div",{ref:n,style:c,...o,...d,className:"touch-none sensitive-touch",children:e.jsx(C,{task:t,onDelete:s,onUpdateStatus:a,isDragging:l})})}function C({task:t,onDelete:s,isDragging:a,isOverlay:o}){return e.jsxs("div",{className:m("card-base p-4 rounded-xl flex items-start gap-3 group bg-white hover:border-slate-300 transition-all duration-200 relative",a&&"opacity-40",o&&"rotate-2 shadow-xl border-slate-300 cursor-grabbing z-50","done"===t.status&&"bg-slate-50 opacity-75"),children:[e.jsx("div",{className:m("w-1.5 h-1.5 rounded-full mt-2 shrink-0","done"===t.status&&"bg-emerald-400","in-progress"===t.status&&"bg-blue-400","todo"===t.status&&"bg-slate-300")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:m("text-sm font-bold text-slate-800 break-words leading-relaxed","done"===t.status&&"text-slate-400 line-through decoration-slate-300"),children:t.text}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:new Date(t.createdAt).toLocaleDateString(void 0,{month:"short",day:"numeric"})}),t.dueDate&&e.jsxs("div",{className:m("flex items-center gap-1 text-[10px] font-bold px-1.5 py-0.5 rounded-md","done"!==t.status&&new Date(t.dueDate)<new Date?"text-red-500 bg-red-50":"text-blue-500 bg-blue-50"),children:[e.jsx(d,{className:"h-3 w-3"}),new Date(t.dueDate).toLocaleDateString(void 0,{month:"short",day:"numeric"})]})]})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),s(t.id)},className:"p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all opacity-0 group-hover:opacity-100",children:e.jsx(n,{className:"h-4 w-4"})})]})}export{k as Tasks};
