const e=(e,t)=>t.some(t=>e instanceof t);let t,n;const s=new WeakMap,o=new WeakMap,a=new WeakMap;let r={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function c(e){r=e(r)}function i(e){return(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(l(this),t),d(this.request)}:function(...t){return d(e.apply(l(this),t))}}function u(n){return"function"==typeof n?i(n):(n instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});s.set(e,t)}(n),e(n,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,r):n)}function d(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(d(e.result)),s()},a=()=>{n(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",a)});return a.set(t,e),t}(e);if(o.has(e))return o.get(e);const t=u(e);return t!==e&&(o.set(e,t),a.set(t,e)),t}const l=e=>a.get(e);const b=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],w=new Map;function j(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,o=y.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!o&&!b.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,o?"readwrite":"readonly");let r=a.store;return s&&(r=r.index(t.shift())),(await Promise.all([r[n](...t),o&&a.done]))[0]};return w.set(t,a),a}c(e=>({...e,get:(t,n,s)=>j(t,n)||e.get(t,n,s),has:(t,n)=>!!j(t,n)||e.has(t,n)}));const f=["continue","continuePrimaryKey","advance"],g={},p=new WeakMap,m=new WeakMap,I={get(e,t){if(!f.includes(t))return e[t];let n=g[t];return n||(n=g[t]=function(...e){p.set(this,m.get(this)[t](...e))}),n}};async function*v(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,I);for(m.set(n,t),a.set(n,l(t));t;)yield n,t=await(p.get(n)||t.continue()),p.delete(n)}function S(t,n){return n===Symbol.asyncIterator&&e(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&e(t,[IDBIndex,IDBObjectStore])}c(e=>({...e,get:(t,n,s)=>S(t,n)?v:e.get(t,n,s),has:(t,n)=>S(t,n)||e.has(t,n)}));let D;const h=()=>(D||(D=function(e,t,{blocked:n,upgrade:s,blocking:o,terminated:a}={}){const r=indexedDB.open(e,t),c=d(r);return s&&r.addEventListener("upgradeneeded",e=>{s(d(r.result),e.oldVersion,e.newVersion,d(r.transaction),e)}),n&&r.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),c.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),c}("student-dashboard-db",5,{upgrade(e,t,n,s){if(e.objectStoreNames.contains("notes")){const e=s.objectStore("notes");e.indexNames.contains("by-subject")||e.createIndex("by-subject","subjectId")}else{const t=e.createObjectStore("notes",{keyPath:"id"});t.createIndex("by-date","updatedAt"),t.createIndex("by-subject","subjectId")}e.objectStoreNames.contains("countdowns")||e.createObjectStore("countdowns",{keyPath:"id"}),e.objectStoreNames.contains("tasks")||e.createObjectStore("tasks",{keyPath:"id"}),e.objectStoreNames.contains("subject_details")||e.createObjectStore("subject_details",{keyPath:"subjectCode"}),e.objectStoreNames.contains("simulator_subjects")||e.createObjectStore("simulator_subjects",{keyPath:"id"})}})),D),B={getNote:async e=>(await h()).get("notes",e),getAllNotes:async()=>(await h()).getAllFromIndex("notes","by-date"),saveNote:async e=>(await h()).put("notes",e),getNotesBySubject:async e=>(await h()).getAllFromIndex("notes","by-subject",e),deleteNote:async e=>(await h()).delete("notes",e),getAllCountdowns:async()=>(await h()).getAll("countdowns"),saveCountdown:async e=>(await h()).put("countdowns",e),deleteCountdown:async e=>(await h()).delete("countdowns",e),getAllTasks:async()=>(await h()).getAll("tasks"),saveTask:async e=>(await h()).put("tasks",e),deleteTask:async e=>(await h()).delete("tasks",e),getSubjectDetails:async e=>(await h()).get("subject_details",e),saveSubjectDetails:async e=>(await h()).put("subject_details",e),getAllSimulatorSubjects:async()=>(await h()).getAll("simulator_subjects"),saveSimulatorSubject:async e=>(await h()).put("simulator_subjects",e),deleteSimulatorSubject:async e=>(await h()).delete("simulator_subjects",e)};export{B as d};
