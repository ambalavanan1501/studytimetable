import{j as e,i as t,J as s,K as a,t as l,c as r,d as n,N as d,X as i,O as c}from"./ui-vendor-tKqBDWI3.js";import{r as o}from"./react-vendor-DR97ylRc.js";import{u as x,c as m,s as h}from"./index-DXsTgZBm.js";import"./pdf-vendor-D0-bFhii.js";import"./supabase-vendor-C9Ts7tiD.js";function u(){const{user:u}=x(),[p,b]=o.useState("mark"),[g,j]=o.useState(new Date),[f,v]=o.useState([]),[N,w]=o.useState([]),[_,y]=o.useState([]),k=e=>e.toISOString().split("T")[0],S=e=>e.toLocaleDateString("en-US",{weekday:"long"}),q=async()=>{if(u)try{if("mark"===p){const e=S(g),t=k(g),[s,a]=await Promise.all([h.from("timetable_entries").select("*").eq("user_id",u.id).eq("day",e),h.from("smart_timetable_entries").select("*").eq("user_id",u.id).eq("day",e)]),l=[...s.data||[],...a.data||[]];l.sort((e,t)=>e.start_time.localeCompare(t.start_time)),v(l);const{data:r}=await h.from("attendance_logs").select("subject_code, status").eq("user_id",u.id).eq("date",t);w(r||[])}else{const[e,t]=await Promise.all([h.from("timetable_entries").select("subject_name, subject_code").eq("user_id",u.id),h.from("smart_timetable_entries").select("subject_name, subject_code").eq("user_id",u.id)]),s=new Map;[...e.data||[],...t.data||[]].forEach(e=>{s.has(e.subject_code)||s.set(e.subject_code,e.subject_name)});const{data:a}=await h.from("attendance_logs").select("subject_code, status").eq("user_id",u.id),l=[];s.forEach((e,t)=>{const s=(null==a?void 0:a.filter(e=>e.subject_code===t))||[],r=s.filter(e=>"present"===e.status).length,n=s.filter(e=>"absent"===e.status).length,d=r+n;l.push({subject_name:e,subject_code:t,total_classes:d,present:r,absent:n,percentage:d>0?Math.round(r/d*100):0})}),y(l)}}catch(e){}};o.useEffect(()=>{q()},[g,u,p]);const C=async(e,t)=>{if(!u)return;const s=k(g);w(s=>[...s.filter(t=>t.subject_code!==e),{subject_code:e,status:t}]);try{const{error:a}=await h.from("attendance_logs").upsert({user_id:u.id,date:s,subject_code:e,status:t},{onConflict:"user_id, date, subject_code"});if(a)throw a}catch(a){q()}},D=e=>{const t=new Date(g);t.setDate(g.getDate()+e),j(t)};return e.jsxs("div",{className:"p-2 md:p-6 space-y-8 pb-32 animate-fade-in-up md:px-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 mt-4 ml-2",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-semibold text-slate-900 tracking-tighter leading-none",children:"Attendance"}),e.jsx("p",{className:"text-lg text-slate-500 font-medium font-display tracking-wide",children:"Stay present, stay ahead."})]}),e.jsx("div",{className:"flex justify-center sticky top-4 z-40",children:e.jsxs("div",{className:"glass-vision p-1.5 rounded-full flex gap-1 shadow-2xl backdrop-blur-3xl border border-white/60",children:[e.jsxs("button",{onClick:()=>b("mark"),className:m("px-6 py-2 rounded-full text-xs font-bold transition-all duration-300 flex items-center gap-2","mark"===p?"bg-slate-900 text-white shadow-lg scale-105":"text-slate-500 hover:text-slate-900 hover:bg-white/40"),children:[e.jsx(t,{className:"h-4 w-4"}),"Mark"]}),e.jsxs("button",{onClick:()=>b("stats"),className:m("px-6 py-2 rounded-full text-xs font-bold transition-all duration-300 flex items-center gap-2","stats"===p?"bg-slate-900 text-white shadow-lg scale-105":"text-slate-500 hover:text-slate-900 hover:bg-white/40"),children:[e.jsx(s,{className:"h-4 w-4"}),"Stats"]})]})}),"mark"===p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-vision p-4 rounded-[2rem] flex items-center justify-between shadow-xl",children:[e.jsx("button",{onClick:()=>D(-1),className:"p-4 hover:bg-white/50 text-slate-400 hover:text-slate-900 rounded-2xl transition-all",children:e.jsx(a,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-[0.2em] text-slate-400 mb-1",children:S(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl font-bold text-slate-900 tracking-tighter tabular-nums",children:g.toLocaleDateString(void 0,{day:"numeric"})}),e.jsx("span",{className:"text-xl font-medium text-slate-500",children:g.toLocaleDateString(void 0,{month:"long"})})]})]}),e.jsx("button",{onClick:()=>D(1),className:"p-4 hover:bg-white/50 text-slate-400 hover:text-slate-900 rounded-2xl transition-all",children:e.jsx(l,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"space-y-6",children:0===f.length?e.jsxs("div",{className:"text-center py-20 px-6 glass-vision rounded-[3rem] border-2 border-dashed border-white/30",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-[2rem] flex items-center justify-center mx-auto mb-6 text-slate-300 animate-float",children:e.jsx(r,{className:"h-10 w-10"})}),e.jsx("p",{className:"text-2xl font-bold text-slate-300 tracking-tight",children:"No classes scheduled"})]}):f.map(t=>{const s=N.find(e=>e.subject_code===t.subject_code),a="present"===(null==s?void 0:s.status),l="absent"===(null==s?void 0:s.status);return e.jsxs("div",{className:"glass-vision p-5 rounded-[1.5rem] group hover:bg-white/60 transition-all duration-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-start mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"glass-panel px-3 py-1 rounded-lg text-[10px] font-black text-slate-500 uppercase tracking-widest",children:t.subject_code}),e.jsx("span",{className:m("text-[10px] px-3 py-1 rounded-lg font-black uppercase tracking-widest","theory"===t.type?"bg-indigo-100 text-indigo-700":"bg-pink-100 text-pink-700"),children:t.type})]}),e.jsx("h3",{className:"font-bold text-2xl text-slate-900 tracking-tight leading-none",children:t.subject_name})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-slate-500 bg-white/40 px-4 py-2 rounded-xl self-start",children:[e.jsx(n,{className:"h-4 w-4"}),t.start_time.slice(0,5)," - ",t.end_time.slice(0,5)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>C(t.subject_code,"present"),className:m("flex items-center justify-center gap-3 py-4 rounded-[1.5rem] font-bold transition-all duration-300 relative overflow-hidden group/btn",a?"bg-emerald-500 text-white shadow-xl shadow-emerald-500/30 scale-[1.02]":"bg-white/50 text-slate-400 hover:bg-emerald-100 hover:text-emerald-600"),children:[e.jsx(d,{className:"h-5 w-5 stroke-[3px]"}),e.jsx("span",{children:"Present"}),a&&e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})]}),e.jsxs("button",{onClick:()=>C(t.subject_code,"absent"),className:m("flex items-center justify-center gap-3 py-4 rounded-[1.5rem] font-bold transition-all duration-300 relative overflow-hidden group/btn",l?"bg-red-500 text-white shadow-xl shadow-red-500/30 scale-[1.02]":"bg-white/50 text-slate-400 hover:bg-red-100 hover:text-red-600"),children:[e.jsx(i,{className:"h-5 w-5 stroke-[3px]"}),e.jsx("span",{children:"Absent"}),l&&e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})]})]})]},t.id)})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:0===_.length?e.jsxs("div",{className:"col-span-full text-center py-20 text-slate-400 glass-vision rounded-[3rem]",children:[e.jsx("p",{className:"text-xl font-bold",children:"No attendance data yet"}),e.jsx("p",{className:"text-sm mt-2 opacity-60",children:"Start marking your classes to see stats!"})]}):_.map(t=>{const s=t.percentage>=75?"bg-emerald-500":"bg-red-500";return e.jsxs("div",{className:"glass-vision p-5 rounded-[1.5rem] hover:scale-[1.02] transition-all duration-500 group relative overflow-hidden",children:[t.percentage<75&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-50 to-transparent opacity-50 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:"font-bold text-slate-900 text-xl leading-tight mb-2 line-clamp-1",title:t.subject_name,children:t.subject_name}),e.jsx("span",{className:"glass-panel px-2 py-1 rounded text-[10px] font-black text-slate-400 uppercase tracking-widest",children:t.subject_code})]}),e.jsxs("div",{className:m("min-w-[4rem] h-[4rem] rounded-[1.5rem] flex items-center justify-center text-xl font-black shadow-lg",t.percentage>=75?"bg-emerald-100 text-emerald-600":"bg-red-100 text-red-600"),children:[t.percentage,e.jsx("span",{className:"text-xs ml-0.5",children:"%"})]})]}),e.jsx("div",{className:"h-4 w-full bg-slate-100/50 rounded-full overflow-hidden mb-6 ring-1 ring-white/50",children:e.jsx("div",{className:m("h-full rounded-full transition-all duration-1000 ease-out shadow-sm",s),style:{width:`${t.percentage}%`}})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{className:"bg-white/40 rounded-2xl p-3 border border-white/60",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400 mb-1",children:"Present"}),e.jsx("div",{className:"text-xl font-black text-emerald-600",children:t.present})]}),e.jsxs("div",{className:"bg-white/40 rounded-2xl p-3 border border-white/60",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400 mb-1",children:"Absent"}),e.jsx("div",{className:"text-xl font-black text-red-600",children:t.absent})]}),e.jsxs("div",{className:"bg-white/40 rounded-2xl p-3 border border-white/60",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400 mb-1",children:"Total"}),e.jsx("div",{className:"text-xl font-black text-slate-700",children:t.total_classes})]})]}),t.percentage<75&&e.jsxs("div",{className:"mt-6 flex items-center gap-3 text-xs font-bold text-red-600 bg-red-100/50 px-4 py-3 rounded-xl border border-red-100/50",children:[e.jsx(c,{className:"h-4 w-4"}),e.jsx("span",{children:"Attendance Critical"})]})]},t.subject_code)})})]})}export{u as Attendance};
