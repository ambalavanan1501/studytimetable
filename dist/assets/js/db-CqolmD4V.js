const e=(e,t)=>t.some(t=>e instanceof t);let t,n;const s=new WeakMap,o=new WeakMap,r=new WeakMap;let a={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function c(e){a=e(a)}function i(e){return(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(l(this),t),d(this.request)}:function(...t){return d(e.apply(l(this),t))}}function u(n){return"function"==typeof n?i(n):(n instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",r),e.removeEventListener("abort",r)},o=()=>{t(),s()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",r),e.addEventListener("abort",r)});s.set(e,t)}(n),e(n,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,a):n)}function d(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",r)},o=()=>{t(d(e.result)),s()},r=()=>{n(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",r)});return r.set(t,e),t}(e);if(o.has(e))return o.get(e);const t=u(e);return t!==e&&(o.set(e,t),r.set(t,e)),t}const l=e=>r.get(e);const b=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],w=new Map;function f(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,o=y.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!o&&!b.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,o?"readwrite":"readonly");let a=r.store;return s&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),o&&r.done]))[0]};return w.set(t,r),r}c(e=>({...e,get:(t,n,s)=>f(t,n)||e.get(t,n,s),has:(t,n)=>!!f(t,n)||e.has(t,n)}));const p=["continue","continuePrimaryKey","advance"],g={},I=new WeakMap,m=new WeakMap,j={get(e,t){if(!p.includes(t))return e[t];let n=g[t];return n||(n=g[t]=function(...e){I.set(this,m.get(this)[t](...e))}),n}};async function*v(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,j);for(m.set(n,t),r.set(n,l(t));t;)yield n,t=await(I.get(n)||t.continue()),I.delete(n)}function D(t,n){return n===Symbol.asyncIterator&&e(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&e(t,[IDBIndex,IDBObjectStore])}c(e=>({...e,get:(t,n,s)=>D(t,n)?v:e.get(t,n,s),has:(t,n)=>D(t,n)||e.has(t,n)}));let S;const h=()=>(S||(S=function(e,t,{blocked:n,upgrade:s,blocking:o,terminated:r}={}){const a=indexedDB.open(e,t),c=d(a);return s&&a.addEventListener("upgradeneeded",e=>{s(d(a.result),e.oldVersion,e.newVersion,d(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),c.then(e=>{r&&e.addEventListener("close",()=>r()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),c}("student-dashboard-db",4,{upgrade(e,t,n,s){if(e.objectStoreNames.contains("notes")){const e=s.objectStore("notes");e.indexNames.contains("by-subject")||e.createIndex("by-subject","subjectId")}else{const t=e.createObjectStore("notes",{keyPath:"id"});t.createIndex("by-date","updatedAt"),t.createIndex("by-subject","subjectId")}e.objectStoreNames.contains("countdowns")||e.createObjectStore("countdowns",{keyPath:"id"}),e.objectStoreNames.contains("tasks")||e.createObjectStore("tasks",{keyPath:"id"}),e.objectStoreNames.contains("simulator_subjects")||e.createObjectStore("simulator_subjects",{keyPath:"id"})}})),S),B={getNote:async e=>(await h()).get("notes",e),getAllNotes:async()=>(await h()).getAllFromIndex("notes","by-date"),saveNote:async e=>(await h()).put("notes",e),getNotesBySubject:async e=>(await h()).getAllFromIndex("notes","by-subject",e),deleteNote:async e=>(await h()).delete("notes",e),getAllCountdowns:async()=>(await h()).getAll("countdowns"),saveCountdown:async e=>(await h()).put("countdowns",e),deleteCountdown:async e=>(await h()).delete("countdowns",e),getAllTasks:async()=>(await h()).getAll("tasks"),saveTask:async e=>(await h()).put("tasks",e),deleteTask:async e=>(await h()).delete("tasks",e),getAllSimulatorSubjects:async()=>(await h()).getAll("simulator_subjects"),saveSimulatorSubject:async e=>(await h()).put("simulator_subjects",e),deleteSimulatorSubject:async e=>(await h()).delete("simulator_subjects",e)};export{B as d};
