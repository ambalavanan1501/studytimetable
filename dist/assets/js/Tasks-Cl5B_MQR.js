import{j as t,V as e,h as s,o as a,k as o,C as r,a0 as i,H as n,T as l}from"./ui-vendor-yoAZ-FXJ.js";import{e as d,r as c}from"./react-vendor-DR97ylRc.js";import{e as m,a as p,d as u,c as x,f as g}from"./index-CNb4MtWx.js";import{S as f}from"./SEO-DgSy9wkE.js";import{u as h,a as j,D as b,c as v,b as y,T as k,P as w,d as N,S as D,v as S,C as T}from"./dnd-vendor-BR2fHiOh.js";import"./pdf-vendor-CnZj0n1s.js";import"./supabase-vendor-C9Ts7tiD.js";const C=[{id:"todo",title:"To Do",color:"bg-slate-100 border-slate-200",icon:a},{id:"in-progress",title:"In Progress",color:"bg-blue-50 border-blue-100",icon:o},{id:"done",title:"Completed",color:"bg-emerald-50 border-emerald-100",icon:r}];function P(){const a=d(),{addXP:o}=m(),{addToast:r}=p(),[i,n]=c.useState([]),[l,x]=c.useState(null),[g,N]=c.useState(""),D=h(j(w,{activationConstraint:{distance:5}}),j(k));c.useEffect(()=>{S()},[]);const S=async()=>{try{const t=(await u.getAllTasks()).map(t=>({...t,status:t.status?t.status:t.completed?"done":"todo"}));n(t.sort((t,e)=>e.createdAt.getTime()-t.createdAt.getTime()))}catch(t){}},T=async t=>{confirm("Delete this task?")&&(await u.deleteTask(t),n(i.filter(e=>e.id!==t)))},P=async(t,e)=>{const s=i.find(e=>e.id===t);if(!s||s.status===e)return;const a={...s,status:e};n(i.map(e=>e.id===t?a:e)),await u.saveTask(a),"done"===e&&(o(50,"Task Completed"),r("Task completed! +50 XP","success"))};return t.jsxs("div",{className:"min-h-screen p-6 pb-24 space-y-6",children:[t.jsx(f,{title:"Kanban Board",description:"Manage your tasks efficiently."}),t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:()=>a(-1),className:"p-2 bg-white rounded-full shadow-sm hover:bg-slate-100 transition-colors",children:t.jsx(e,{className:"h-6 w-6 text-slate-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Task Board"}),t.jsx("p",{className:"text-slate-500 text-xs",children:"Drag and drop to manage workflow"})]})]}),t.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!g.trim())return;const e={id:crypto.randomUUID(),text:g.trim(),status:"todo",createdAt:new Date};await u.saveTask(e),n([e,...i]),N(""),o(10,"Task Created")},className:"flex gap-2",children:[t.jsx("input",{type:"text",value:g,onChange:t=>N(t.target.value),placeholder:"Add new task...",className:"glass-input px-4 py-2 rounded-xl focus:ring-2 focus:ring-primary-500 w-full md:w-64"}),t.jsx("button",{type:"submit",disabled:!g.trim(),className:"bg-primary-600 text-white p-2 rounded-xl hover:bg-primary-700 transition-colors disabled:opacity-50",children:t.jsx(s,{className:"h-6 w-6"})})]})]}),t.jsxs(b,{sensors:D,collisionDetection:v,onDragStart:t=>{x(t.active.id)},onDragEnd:async t=>{const{active:e,over:s}=t;if(x(null),!s)return;const a=i.find(t=>t.id===e.id);if(!a)return;let l=null;if(C.some(t=>t.id===s.id))l=s.id;else{const t=i.find(t=>t.id===s.id);t&&(l=t.status)}if(l&&l!==a.status){const t={...a,status:l};n(i.map(s=>s.id===e.id?t:s)),await u.saveTask(t),"done"===l&&"done"!==a.status&&(o(50,"Task Completed"),r("Task moved to Completed! +50 XP","success"))}},children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 h-full items-start",children:C.map(e=>t.jsx(U,{column:e,tasks:i.filter(t=>t.status===e.id),onDelete:T,onUpdateStatus:P},e.id))}),t.jsx(y,{children:l?t.jsx(E,{task:i.find(t=>t.id===l),onDelete:()=>{},onUpdateStatus:()=>{},isOverlay:!0}):null})]})]})}function U({column:e,tasks:s,onDelete:a,onUpdateStatus:o}){const{setNodeRef:r}=N({id:e.id,data:{type:"Column",column:e}});return t.jsxs("div",{ref:r,className:x("bg-slate-50/50 rounded-2xl p-4 min-h-[500px] border-2 border-dashed border-slate-200 transition-colors",e.color),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 text-slate-500 font-bold uppercase text-xs tracking-wider",children:[t.jsx(e.icon,{className:"h-4 w-4"}),e.title," ",t.jsx("span",{className:"bg-white/50 px-2 py-0.5 rounded-full text-[10px] ml-auto",children:s.length})]}),t.jsx(D,{items:s.map(t=>t.id),strategy:S,children:t.jsxs("div",{className:"space-y-3",children:[s.map(e=>t.jsx(A,{task:e,onDelete:a,onUpdateStatus:o},e.id)),0===s.length&&t.jsx("div",{className:"h-24 flex items-center justify-center text-slate-300 text-xs italic",children:"Empty"})]})})]})}function A({task:e,onDelete:s,onUpdateStatus:a}){const{attributes:o,listeners:r,setNodeRef:i,transform:n,transition:l,isDragging:d}=N({id:e.id,data:{type:"Task",task:e}}),c={transform:T.Transform.toString(n),transition:l};return t.jsx("div",{ref:i,style:c,...o,...r,children:t.jsx(E,{task:e,onDelete:s,onUpdateStatus:a,isDragging:d})})}function E({task:e,onDelete:s,onUpdateStatus:a,isDragging:o,isOverlay:r}){const{startFocus:d}=g();return t.jsxs("div",{className:x("glass-card p-4 rounded-xl flex items-start gap-3 group bg-white shadow-sm border border-slate-100",o&&"opacity-30",r&&"rotate-2 scale-105 shadow-xl cursor-grabbing ring-2 ring-primary-500 ring-offset-2 z-50"),children:[t.jsx("button",{className:"mt-1 text-slate-300 cursor-grab active:cursor-grabbing",children:t.jsx(i,{className:"h-4 w-4"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-slate-700 break-words leading-relaxed",children:e.text}),t.jsx("span",{className:"text-[10px] text-slate-400 mt-2 block",children:new Date(e.createdAt).toLocaleDateString()})]}),"done"!==e.status&&t.jsx("button",{onClick:t=>{t.stopPropagation(),d(25,e.text),"in-progress"!==e.status&&"done"!==e.status&&a(e.id,"in-progress")},className:"opacity-0 group-hover:opacity-100 p-1.5 text-slate-300 hover:text-emerald-500 hover:bg-emerald-50 rounded-lg transition-all",title:"Start Deep Work Session",onPointerDown:t=>t.stopPropagation(),children:t.jsx(n,{className:"h-4 w-4"})}),t.jsx("button",{onClick:t=>{t.stopPropagation(),s(e.id)},className:"opacity-0 group-hover:opacity-100 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",onPointerDown:t=>t.stopPropagation(),children:t.jsx(l,{className:"h-4 w-4"})})]})}export{P as Tasks};
