import{j as e,X as t,U as s,L as a,a as l,S as r,A as n,m as i,D as o,F as c,n as d,T as m,o as x,d as u,k as p,M as f,p as h,q as b,r as g,s as j,t as v,u as w,v as y,w as N}from"./ui-vendor-DKQiA0eN.js";import{r as _,f as k}from"./react-vendor-UBAF-OWM.js";import{u as S,b as C,c as T,s as A,d as D,a as P,e as F}from"./index-Ci4fGroD.js";import{E,a as O,_ as q}from"./pdf-vendor-0-8C3xHX.js";import{S as L}from"./SEO-DlDTCelI.js";import{d as z}from"./db-D0LAGLHJ.js";import"./supabase-vendor-B9h0k0q2.js";function R({isOpen:n,onClose:i,currentProfile:o,onSuccess:c}){const{user:d}=S(),{level:m}=C(),[x,u]=_.useState(!1),[p,f]=_.useState({full_name:"",university:"",branch:"",semester:"",cgpa:"",credits:"",avatar_url:""});_.useEffect(()=>{var e,t;o&&f({full_name:o.full_name||"",university:o.university||"",branch:o.branch||"",semester:o.semester||"",cgpa:(null==(e=o.cgpa)?void 0:e.toString())||"",credits:(null==(t=o.credits)?void 0:t.toString())||"",avatar_url:o.avatar_url||""})},[o]);return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Edit Profile"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d){u(!0);try{const{error:e}=await A.from("profiles").upsert({id:d.id,full_name:p.full_name,university:p.university,branch:p.branch,semester:p.semester,cgpa:parseFloat(p.cgpa)||0,credits:parseFloat(p.credits)||0,updated_at:(new Date).toISOString()});if(e)throw e;c(),i()}catch(t){}finally{u(!1)}}},className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[e.jsx("div",{className:T("w-24 h-24 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden border-4 shadow-lg transition-all duration-300",m>=5?"border-indigo-400 shadow-indigo-200":"border-white"),children:p.avatar_url?e.jsx("img",{src:p.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(s,{className:"h-10 w-10 text-slate-400"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-slate-100 px-3 py-1 rounded-full text-xs font-bold text-slate-600 border border-slate-200",children:["Lvl ",m]}),m<5&&e.jsxs("div",{className:"text-[10px] text-slate-400 font-bold flex items-center gap-1",children:[e.jsx(a,{className:"h-3 w-3"}),e.jsx("span",{children:"Lvl 5 unlocks border"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Full Name"}),e.jsx("input",{type:"text",value:p.full_name,onChange:e=>f({...p,full_name:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"John Doe"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"University"}),e.jsx("input",{type:"text",value:p.university,onChange:e=>f({...p,university:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"University Name"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Branch/Major"}),e.jsx("input",{type:"text",value:p.branch,onChange:e=>f({...p,branch:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"Computer Science"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Semester"}),e.jsx("input",{type:"text",value:p.semester,onChange:e=>f({...p,semester:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"Fall 2024"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"CGPA"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"10",value:p.cgpa,onChange:e=>f({...p,cgpa:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"9.5"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider ml-1",children:"Credits"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:p.credits,onChange:e=>f({...p,credits:e.target.value}),className:"glass-input w-full px-4 py-2.5 rounded-xl font-bold text-slate-700 focus:bg-white/80 transition-all",placeholder:"24.5"})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:i,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:x,className:"bg-slate-900 text-white px-8 py-2.5 rounded-xl font-bold hover:scale-105 active:scale-95 transition-all shadow-lg flex items-center gap-2",children:[x?e.jsx(l,{className:"h-4 w-4 animate-spin"}):e.jsx(r,{className:"h-4 w-4"}),"Save Changes"]})]})]})]})}):null}function I({isOpen:s,onClose:a}){const{user:r}=S(),[m,x]=_.useState(!1),[u,p]=_.useState(null),f=_.useRef(null);if(!s)return null;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-white/50 animate-in fade-in zoom-in duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"App Settings"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),u&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl flex items-center gap-2 text-sm font-medium "+("success"===u.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[e.jsx(n,{className:"h-4 w-4"}),u.text]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider",children:"Export Data"}),e.jsxs("button",{onClick:async()=>{if(r){x(!0),p(null);try{const[e,t]=await Promise.all([A.from("timetable_entries").select("*").eq("user_id",r.id),A.from("smart_timetable_entries").select("*").eq("user_id",r.id)]),s={timestamp:(new Date).toISOString(),timetable_entries:e.data||[],smart_timetable_entries:t.data||[]},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=`timetable_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),p({type:"success",text:"Backup downloaded successfully!"})}catch(e){p({type:"error",text:"Failed to export data."})}finally{x(!1)}}},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:scale-110 transition-transform",children:e.jsx(i,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Backup as JSON"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Save all your data to a file"})]})]}),e.jsx(o,{className:"h-5 w-5 text-slate-400"})]}),e.jsxs("button",{onClick:async()=>{if(r){x(!0),p(null);try{const{data:e}=await A.from("timetable_entries").select("*").eq("user_id",r.id),{data:t}=await A.from("smart_timetable_entries").select("*").eq("user_id",r.id),s=[...e||[],...t||[]],a={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:7};s.sort((e,t)=>{const s=(a[e.day]||0)-(a[t.day]||0);return 0!==s?s:e.start_time.localeCompare(t.start_time)});const l=new E;l.setFontSize(20),l.text("My Timetable",14,22),l.setFontSize(10),l.text(`Generated on ${(new Date).toLocaleDateString()}`,14,30);const n=s.map(e=>[e.day,`${e.start_time.slice(0,5)} - ${e.end_time.slice(0,5)}`,e.subject_name,e.room_number||"-",e.type.toUpperCase()]);O(l,{head:[["Day","Time","Subject","Room","Type"]],body:n,startY:40,styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[147,51,234]},alternateRowStyles:{fillColor:[243,244,246]}}),l.save("timetable.pdf"),p({type:"success",text:"PDF downloaded successfully!"})}catch(e){p({type:"error",text:"Failed to generate PDF."})}finally{x(!1)}}},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 group-hover:scale-110 transition-transform",children:e.jsx(c,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Export as PDF"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Download printable timetable"})]})]}),e.jsx(o,{className:"h-5 w-5 text-slate-400"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider",children:"Import Data"}),e.jsxs("button",{onClick:()=>{var e;return null==(e=f.current)?void 0:e.click()},disabled:m,className:"w-full p-4 glass-card rounded-xl flex items-center justify-between hover:bg-white/60 transition-colors group border-2 border-dashed border-slate-300 hover:border-purple-400",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 group-hover:scale-110 transition-transform",children:e.jsx(d,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700",children:"Restore from Backup"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload a JSON file to restore"})]})]}),m&&e.jsx(l,{className:"h-5 w-5 animate-spin text-purple-600"})]}),e.jsx("input",{type:"file",ref:f,onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s||!r)return;x(!0),p(null);const a=new FileReader;a.onload=async e=>{var t;try{const s=JSON.parse(null==(t=e.target)?void 0:t.result);if(!s.timetable_entries&&!s.smart_timetable_entries)throw new Error("Invalid backup file format");const a=(s.timetable_entries||[]).map(({id:e,created_at:t,...s})=>({...s,user_id:r.id})),l=(s.smart_timetable_entries||[]).map(({id:e,created_at:t,...s})=>({...s,user_id:r.id}));if(a.length>0){const{error:e}=await A.from("timetable_entries").insert(a);if(e)throw e}if(l.length>0){const{error:e}=await A.from("smart_timetable_entries").insert(l);if(e)throw e}p({type:"success",text:"Data imported successfully! Refreshing..."}),setTimeout(()=>window.location.reload(),1500)}catch(s){p({type:"error",text:"Failed to import data. Invalid file."})}finally{x(!1),f.current&&(f.current.value="")}},a.readAsText(s)},accept:".json",className:"hidden"})]})]})]})})})}function $({isOpen:s,onClose:a,classData:n,onSuccess:i}){const[o,c]=_.useState(!1),[d,x]=_.useState({subject_name:"",subject_code:"",room_number:"",start_time:"",end_time:""});if(_.useEffect(()=>{n&&x({subject_name:n.subject_name||"",subject_code:n.subject_code||"",room_number:n.room_number||"",start_time:n.start_time||"",end_time:n.end_time||""})},[n]),!s||!n)return null;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-white/50 animate-in fade-in zoom-in duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Edit Class"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0);try{const e={subject_name:d.subject_name,subject_code:d.subject_code,room_number:d.room_number,start_time:d.start_time,end_time:d.end_time},{error:t}=await A.from("timetable_entries").update(e).eq("id",n.id),{error:s}=await A.from("smart_timetable_entries").update(e).eq("id",n.id);if(t&&s)throw new Error("Failed to update class");i(),a()}catch(t){}finally{c(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Subject Name"}),e.jsx("input",{type:"text",value:d.subject_name,onChange:e=>x({...d,subject_name:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Subject Code"}),e.jsx("input",{type:"text",value:d.subject_code,onChange:e=>x({...d,subject_code:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Room"}),e.jsx("input",{type:"text",value:d.room_number,onChange:e=>x({...d,room_number:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:d.start_time,onChange:e=>x({...d,start_time:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:d.end_time,onChange:e=>x({...d,end_time:e.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-primary-500 transition-all",required:!0})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-bold shadow-lg shadow-primary-200 transition-all flex items-center justify-center gap-2 mt-4",children:[o?e.jsx(l,{className:"h-5 w-5 animate-spin"}):e.jsx(r,{className:"h-5 w-5"}),"Save Changes"]}),e.jsxs("button",{type:"button",onClick:async()=>{if(confirm("Are you sure you want to delete this class?")){c(!0);try{await A.from("timetable_entries").delete().eq("id",n.id),await A.from("smart_timetable_entries").delete().eq("id",n.id),i(),a()}catch(e){}finally{c(!1)}}},disabled:o,className:"w-full py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:[e.jsx(m,{className:"h-5 w-5"}),"Delete Class"]})]})]})})})}function U({isOpen:s,onClose:a}){const{user:r}=S(),[n,i]=_.useState(!0),[o,c]=_.useState([]),[d,m]=_.useState(""),[b,g]=_.useState(null),[j,v]=_.useState(!1),w=async()=>{if(r){i(!0);try{const{data:e}=await A.from("timetable_entries").select("*").eq("user_id",r.id),{data:t}=await A.from("smart_timetable_entries").select("*").eq("user_id",r.id),s=[...e||[],...t||[]],a={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:7};s.sort((e,t)=>{const s=(a[e.day]||8)-(a[t.day]||8);return 0!==s?s:e.start_time.localeCompare(t.start_time)}),c(s)}catch(e){}finally{i(!1)}}};_.useEffect(()=>{s&&w()},[s,r]);const y=o.filter(e=>e.subject_name.toLowerCase().includes(d.toLowerCase())||e.subject_code.toLowerCase().includes(d.toLowerCase()));return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[80vh] animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Manage Timetable"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Edit or remove your scheduled classes"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(t,{className:"h-5 w-5 text-slate-500"})})]}),e.jsx("div",{className:"p-4 bg-slate-50 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search subjects...",value:d,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-xl border-none focus:ring-2 focus:ring-primary-500 bg-white shadow-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:n?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(l,{className:"h-8 w-8 animate-spin text-primary-500"})}):0===y.length?e.jsx("div",{className:"text-center py-10 text-slate-400",children:e.jsx("p",{children:"No classes found."})}):y.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between group hover:border-primary-200 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h3",{className:"font-bold text-slate-800 truncate",children:t.subject_name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 mt-1",children:[e.jsx("span",{className:"bg-slate-100 px-2 py-0.5 rounded text-slate-600 font-medium",children:t.subject_code}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"h-3 w-3"}),e.jsx("span",{children:t.day})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.start_time," - ",t.end_time]})]}),t.room_number&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-3 w-3"}),e.jsx("span",{children:t.room_number})]})]})]}),e.jsx("button",{onClick:()=>(e=>{g(e),v(!0)})(t),className:"p-2 text-slate-300 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all",children:e.jsx(h,{className:"h-5 w-5"})})]},t.id))})]}),e.jsx($,{isOpen:j,onClose:()=>v(!1),classData:b,onSuccess:()=>{w()}})]}):null}async function M(e){try{const{jsPDF:t,autoTable:s}=await async function(){const[{default:e},{default:t}]=await Promise.all([q(()=>import("./pdf-vendor-0-8C3xHX.js").then(e=>e.j),[]),q(()=>import("./pdf-vendor-0-8C3xHX.js").then(e=>e.c),[])]);return{jsPDF:e,autoTable:t}}(),a=new t,l=20;let r=20;const{data:n}=await A.from("profiles").select("*").eq("id",e).single(),{data:i}=await A.from("attendance_logs").select("*").eq("user_id",e);a.setFontSize(24),a.setTextColor(80,70,229),a.text("Student Academic Report",l,r),r+=10,a.setFontSize(10),a.setTextColor(100),a.text(`Generated on: ${(new Date).toLocaleDateString()}`,l,r),r+=15,a.setDrawColor(200),a.line(l,r,190,r),r+=10,a.setFontSize(14),a.setTextColor(0),a.text("Student Profile",l,r),r+=8,a.setFontSize(11),a.setTextColor(60);const o=(null==n?void 0:n.full_name)||"N/A",c=(null==n?void 0:n.university)||"N/A",d=`${(null==n?void 0:n.branch)||"-"} (${(null==n?void 0:n.semester)||"-"})`,m=(null==n?void 0:n.cgpa)?`${n.cgpa}`:"N/A";a.text(`Name: ${o}`,l,r),a.text(`University: ${c}`,110,r),r+=7,a.text(`Branch: ${d}`,l,r),a.text(`CGPA: ${m}`,110,r),r+=15;const x=new Map;null==i||i.forEach(e=>{const t=x.get(e.subject_name)||{total:0,attended:0};t.total+=1,"present"===e.status&&(t.attended+=1),x.set(e.subject_name,t)}),a.setFontSize(14),a.setTextColor(0),a.text("Attendance Summary",l,r),r+=5;const u=Array.from(x.entries()).map(([e,t])=>{const s=t.total-t.attended,a=t.total>0?(t.attended/t.total*100).toFixed(1)+"%":"0%";return[e,t.attended,s,t.total,a]});u.length>0?(s(a,{startY:r,head:[["Subject","Attended","Absent","Total Classes","Percentage"]],body:u,theme:"grid",headStyles:{fillColor:[80,70,229]},styles:{fontSize:10},margin:{top:20}}),r=a.lastAutoTable.finalY+20):(r+=10,a.setFontSize(10),a.setTextColor(150),a.text("No attendance records found.",l,r),r+=20,r+=20);const p=await z.getAllNotes();return p&&p.length>0&&(r>250&&(a.addPage(),r=20),a.setFontSize(14),a.setTextColor(0),a.text("Academic Vault (Notes)",l,r),r+=10,p.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),p.forEach(e=>{r>270&&(a.addPage(),r=20),a.setFontSize(12),a.setTextColor(0);const t=e.title||"Untitled Note";a.text(`• ${t}`,l,r),r+=7,a.setFontSize(10),a.setTextColor(80);const s=new Date(e.updatedAt).toLocaleDateString();a.text(`${s}`,l+5,r),r+=5,a.setFontSize(10),a.setTextColor(100);const n=a.splitTextToSize(e.content||"No content",170);a.text(n,l+5,r),r+=5*n.length+10})),a.setFontSize(8),a.setTextColor(150),a.text("Generated by CGPA Calculator",l,280),a.save(`report_${(new Date).toISOString().split("T")[0]}.pdf`),!0}catch(t){throw t}}function B(){var t,s,r;const{user:n}=S(),{themeStyle:i,setThemeStyle:d,mode:x,setMode:p,setAccent:f}=D(),{addToast:h}=P(),{level:E,xp:O}=C(),{privacyMode:q,setPrivacyMode:$,appLockEnabled:B,setAppLockEnabled:J,setAppPin:G,notificationsEnabled:V,setNotificationsEnabled:Y}=F(),W=k(),[Q,X]=_.useState(null),[H,K]=_.useState(!0),[Z,ee]=_.useState(!1),[te,se]=_.useState(!1),[ae,le]=_.useState(!1),[re,ne]=_.useState(!1),[ie,oe]=_.useState(!1),ce=async()=>{if(n)try{const{data:e,error:t}=await A.from("profiles").select("*").eq("id",n.id).single();t&&t.code;const s=e||{full_name:"",university:"",branch:"",semester:"",theme_preference:"light",attendance_goal:75,accent_color:"purple",cgpa:0,credits:0,avatar_url:null};X(s),s.accent_color&&f(s.accent_color)}catch(e){}finally{K(!1)}};_.useEffect(()=>{ce()},[n]);return H?e.jsx("div",{className:"flex h-full items-center justify-center pt-20",children:e.jsx(l,{className:"h-8 w-8 animate-spin text-primary-600"})}):e.jsxs("div",{className:"pb-32 space-y-10 animate-fade-in-up md:px-4",children:[e.jsx(L,{title:"Profile",description:"Manage your profile settings and goals."}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4 ml-2",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-semibold text-slate-900 tracking-tighter leading-none",children:"Profile"}),e.jsx("p",{className:"text-lg text-slate-500 font-medium font-display tracking-wide",children:"Identity & Preferences."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 auto-rows-min",children:[e.jsxs("div",{className:"md:col-span-2 glass-vision rounded-[2.5rem] p-8 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-slate-900/5 blur-3xl rounded-full -translate-y-1/2 translate-x-1/3 pointer-events-none"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 relative z-10",children:[e.jsxs("div",{className:"relative group/avatar",children:[e.jsxs("div",{className:"w-32 h-32 rounded-full ring-8 ring-white/30 shadow-2xl overflow-hidden relative cursor-pointer",children:[(null==Q?void 0:Q.avatar_url)?e.jsx("img",{src:Q.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-slate-100 flex items-center justify-center text-4xl font-bold text-slate-400",children:(null==(t=null==Q?void 0:Q.full_name)?void 0:t[0])||(null==(r=null==(s=null==n?void 0:n.email)?void 0:s[0])?void 0:r.toUpperCase())}),e.jsxs("label",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover/avatar:opacity-100 transition-opacity cursor-pointer backdrop-blur-[2px]",children:[e.jsx("span",{className:"text-white text-xs font-bold uppercase tracking-wider",children:re?"...":"Change"}),e.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{try{if(ne(!0),!e.target.files||0===e.target.files.length)throw new Error("You must select an image to upload.");const t=e.target.files[0],s=t.name.split(".").pop(),a=`${`${Math.random()}.${s}`}`,{error:l}=await A.storage.from("avatars").upload(a,t);if(l)throw l;const{data:r}=A.storage.from("avatars").getPublicUrl(a),i=r.publicUrl;if(n&&Q){const{error:e}=await A.from("profiles").update({avatar_url:i}).eq("id",n.id);if(e)throw e;X({...Q,avatar_url:i}),h("Profile picture updated!","success")}}catch(t){h("Error uploading avatar!","error")}finally{ne(!1)}},disabled:re,className:"hidden"})]})]}),e.jsxs("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2 glass-panel px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest text-slate-500 shadow-lg whitespace-nowrap flex gap-2",children:[e.jsxs("span",{children:["Lvl ",E]}),e.jsxs("span",{className:"text-indigo-500",children:[O," XP"]})]})]}),e.jsxs("div",{className:"text-center md:text-left space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-slate-900 tracking-tight leading-none",children:(null==Q?void 0:Q.full_name)||"Student"}),e.jsx("p",{className:"text-slate-500 font-medium",children:null==n?void 0:n.email})]}),e.jsxs("div",{className:"flex flex-wrap justify-center md:justify-start gap-2 pt-2",children:[e.jsxs("button",{onClick:()=>ee(!0),className:"glass-button px-4 py-2 rounded-full text-xs font-bold flex items-center gap-2 text-slate-600 hover:text-slate-900",children:[e.jsx(b,{className:"h-3 w-3"}),"Edit Profile"]}),e.jsxs("button",{onClick:async()=>{await A.auth.signOut(),W("/login")},className:"glass-button px-4 py-2 rounded-full text-xs font-bold flex items-center gap-2 text-red-500 hover:bg-red-50",children:[e.jsx(g,{className:"h-3 w-3"}),"Sign Out"]})]})]})]})]}),e.jsxs("div",{className:"md:col-span-1 glass-vision rounded-[2.5rem] p-6 flex flex-col gap-6 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-pink-50 text-pink-500 flex items-center justify-center",children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx("h3",{className:"font-bold text-slate-900",children:"Appearance"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Visual Style"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["spatial","neo","swiss"].map(t=>e.jsx("button",{onClick:()=>d(t),className:T("px-2 py-2 rounded-xl text-xs font-bold transition-all border-2",i===t?"border-slate-900 bg-slate-900 text-white":"border-transparent bg-slate-100 text-slate-500 hover:bg-slate-200"),children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-slate-50 border border-slate-100 transition-colors hover:bg-slate-100",children:[e.jsx("span",{className:"text-sm font-bold text-slate-600",children:"Dark Mode"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:"dark"===x,onChange:e=>p(e.target.checked?"dark":"light")}),e.jsx("div",{className:"w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-slate-900"})]})]})]}),e.jsxs("div",{className:"md:col-span-3 glass-vision rounded-[2.5rem] p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center",children:e.jsx(v,{className:"h-5 w-5"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Control Center"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-white/40 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:T("w-10 h-10 rounded-full flex items-center justify-center transition-colors",q?"bg-slate-800 text-white":"bg-slate-100 text-slate-500"),children:q?e.jsx(w,{className:"h-5 w-5"}):e.jsx(y,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-slate-700",children:"Privacy Mode"}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-wider",children:"Blur Stats"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:q,onChange:e=>$(e.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-slate-800"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-white/40 border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:T("w-10 h-10 rounded-full flex items-center justify-center transition-colors",B?"bg-red-500 text-white":"bg-red-50 text-red-400"),children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-slate-700",children:"App Lock"}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-wider",children:"PIN Security"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:B,onChange:()=>{if(B){prompt("Enter PIN to disable:")===localStorage.getItem("app-pin")?(J(!1),G(null),h("App Lock disabled.","success")):h("Incorrect PIN.","error")}else{const e=prompt("Set your 4-digit PIN:");e&&4===e.length&&/^\d+$/.test(e)?(G(e),J(!0),h("App Lock enabled!","success")):e&&h("Invalid PIN. Must be 4 digits.","error")}}}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-amber-50/50 border border-amber-100/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:T("w-10 h-10 rounded-full flex items-center justify-center transition-colors",V?"bg-amber-500 text-white":"bg-white text-amber-500"),children:e.jsx(N,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-slate-700",children:"Class Alerts"}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-wider",children:"Browser Nots"})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500",children:"Enable"}),e.jsxs("div",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:V,onChange:e=>Y(e.target.checked)}),e.jsx("div",{className:"w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-amber-500"})]})]})})]})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest ml-4 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{icon:u,label:"Timetable",sub:"Manage",action:()=>le(!0),color:"bg-indigo-500"},{icon:c,label:"Report",sub:"Export PDF",action:async()=>{if(n)try{oe(!0),await M(n.id),h("PDF report generated.","success")}catch(e){h("Failed to generate PDF report.","error")}finally{oe(!1)}},color:"bg-blue-500"},{icon:o,label:"Backup",sub:"Save JSON",action:async()=>{if(n)try{oe(!0),await async function(e){try{const{data:t}=await A.from("profiles").select("*").eq("id",e).single(),{data:s}=await A.from("timetable_entries").select("*").eq("user_id",e),{data:a}=await A.from("smart_timetable_entries").select("*").eq("user_id",e),{data:l}=await A.from("attendance_logs").select("*").eq("user_id",e),r=await z.getAllSimulatorSubjects(),n=await z.getAllNotes(),i=await z.getAllCountdowns(),o=await z.getAllTasks(),c={version:1,timestamp:(new Date).toISOString(),user:{id:e,profile:t||{}},academics:{timetable:s||[],smart_timetable:a||[],attendance_logs:l||[]},local_data:{simulator_subjects:r||[],notes:n||[],countdowns:i||[],tasks:o||[]}},d=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),m=URL.createObjectURL(d),x=document.createElement("a");return x.href=m,x.download=`academic_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m),!0}catch(t){throw t}}(n.id),h("Backup downloaded successfully.","success")}catch(e){h("Failed to backup data.","error")}finally{oe(!1)}},color:"bg-sky-500"},{icon:m,label:"Reset",sub:"Clear Data",action:async()=>{if(n&&confirm("Are you sure you want to delete all timetable and attendance data? This action cannot be undone."))try{K(!0),await A.from("timetable_entries").delete().eq("user_id",n.id),await A.from("smart_timetable_entries").delete().eq("user_id",n.id),await A.from("attendance_logs").delete().eq("user_id",n.id),h("All data has been reset successfully.","success")}catch(e){h("Failed to reset data.","error")}finally{K(!1)}},color:"bg-red-500"}].map((t,s)=>e.jsxs("button",{onClick:t.action,className:"glass-vision p-4 rounded-[2rem] flex items-center gap-4 hover:bg-white/60 transition-all hover:-translate-y-1 group",children:[e.jsx("div",{className:T("w-12 h-12 rounded-2xl flex items-center justify-center text-white shadow-lg transition-transform group-hover:scale-110",t.color),children:"Report"===t.label&&ie?e.jsx(l,{className:"h-5 w-5 animate-spin"}):e.jsx(t.icon,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"block font-bold text-slate-900",children:t.label}),e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:t.sub})]})]},s))})]})]}),e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-slate-300",children:"NikiOS v11.0 • Designed by Antigravity"})}),e.jsx(R,{isOpen:Z,onClose:()=>ee(!1),currentProfile:Q,onSuccess:ce}),e.jsx(I,{isOpen:te,onClose:()=>se(!1)}),e.jsx(U,{isOpen:ae,onClose:()=>le(!1)})]})}export{B as Profile};
